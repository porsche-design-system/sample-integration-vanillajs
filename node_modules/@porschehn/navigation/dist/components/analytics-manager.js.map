{"file":"analytics-manager.js","mappings":"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","names":["Logger"],"sources":["src/state/router-store.ts","src/utility/constants/ab-testing.ts","src/services/ab-testing/matomo-ab-testing-service.ts","src/services/ab-testing/ab-testing-constructor-service.ts","src/services/menu-items-service.ts","src/services/analytics/analytics-manager.ts"],"sourcesContent":["import { createStore } from '@stencil/store';\n\ninterface RouterStore {\n  routingKeyHistory: string[];\n  routingKeyPointer: number;\n  initialRoutingKeyHistory: string[] | null;\n  initialRoutingKeyPointer: number | null;\n}\n\nexport const routerStore = createStore<RouterStore>({\n  routingKeyHistory: [],\n  routingKeyPointer: -1,\n  initialRoutingKeyHistory: null,\n  initialRoutingKeyPointer: null\n});\n","export type ExperimentDefinition = Record<string, unknown>;\n\nexport type AvailableExperiment = (typeof experimentsDefinitions)[keyof typeof experimentsDefinitions];\n\nexport const experimentsDefinitions: ExperimentDefinition = {};\n\nexport interface MatomoClient {\n  track: () => void;\n  AbTesting: {\n    Experiment: { new (definition: unknown): Experiment };\n  };\n}\n\nexport interface Experiment {\n  name: string;\n  getActivatedVariationName: () => string;\n  variations: Variation[];\n}\n\nexport interface Variation {\n  name: string;\n  activate: () => unknown;\n}\n","import { navStateStore } from '../../state/nav-state-store';\nimport { NaviError, NaviErrorTypes } from '../../utility/navi-error';\nimport { IAbTestingService } from './ab-testing-service.interface';\nimport {\n  AvailableExperiment,\n  Experiment,\n  experimentsDefinitions,\n  MatomoClient,\n  Variation\n} from '../../utility/constants/ab-testing';\nimport Logger from '../logger';\nimport { getHTMLElement } from '../../utility/helper';\nimport featureToggles from '../feature-toggles';\nimport { TMenu, VariationDefinition } from '../../entities/content';\nimport { navContentStore } from '../../state/nav-content-store';\n\nexport class MatomoAbTestingService implements IAbTestingService {\n  client: MatomoClient | null = null;\n  experiments: Experiment[] = [];\n\n  async init(): Promise<void> {\n    if (featureToggles.isABTestingToggleActive()) {\n      try {\n        await this.setClient();\n        await this.loadExperiments();\n      } catch (e) {\n        Logger.error('Could not initialize AbTesting', e as Error);\n      }\n    }\n  }\n\n  execute(experimentName: AvailableExperiment): void {\n    if (featureToggles.isABTestingToggleActive()) {\n      try {\n        const experiment = this.getExperiment(experimentName);\n        const variation = this.getVariation(experiment);\n        variation.activate();\n      } catch (e) {\n        Logger.error(`Could not execute experiment ${experimentName}`, e as Error);\n      }\n    }\n  }\n\n  executeContentChange(menu: TMenu): TMenu[] {\n    if (featureToggles.isABTestingToggleActive()) {\n      try {\n        const experiment = this.getExperiment(menu.experienceName);\n        const variation = this.getVariation(experiment);\n        if (variation.name === 'original') {\n          return menu.children;\n        }\n        return variation.activate() as unknown as TMenu[];\n      } catch (e) {\n        Logger.error(`Could not execute experiment ${menu.experienceName}`, e as Error);\n      }\n    }\n    return menu.children;\n  }\n\n  private async setClient(): Promise<MatomoClient> {\n    if (this.client) return Promise.resolve(this.client);\n\n    await this.injectScript();\n    const w = window as any;\n    this.client = w.Matomo as MatomoClient;\n    return this.client;\n  }\n\n  private async loadExperiments(): Promise<void> {\n    const client = this.getClient();\n    const ExperimentCreator = client.AbTesting.Experiment;\n    const experimentsDefinitions = this.getAbTestingDefinitions();\n    for (const experimentKey in experimentsDefinitions) {\n      const experimentDefinition = experimentsDefinitions[experimentKey];\n      const experiment = new ExperimentCreator(experimentDefinition);\n      this.experiments.push(experiment);\n    }\n  }\n\n  async loadContentGeneratorExperiments(): Promise<void> {\n    if (featureToggles.isABTestingToggleActive()) {\n      const client = this.getClient();\n      const ExperimentCreator = client.AbTesting.Experiment;\n      const contentDefinitions = navContentStore.state.abExperiences;\n\n      if (contentDefinitions) {\n        for (const experimentDefinition of contentDefinitions) {\n          const variationDefinition: Variation[] = experimentDefinition.variations.map(\n            (variation: VariationDefinition) => ({\n              name: variation.name,\n              activate: () => variation.children\n            })\n          );\n          variationDefinition.push({\n            name: 'original',\n            activate: () => null\n          });\n          const experiment = new ExperimentCreator({ ...experimentDefinition, variations: variationDefinition });\n          this.experiments.push(experiment);\n        }\n      }\n    }\n  }\n\n  private getExperiment(name: AvailableExperiment): Experiment {\n    const experiment = this.experiments.find((experiment) => experiment.name === name);\n    if (!experiment) throw new NaviError(`No experiment with name: ${name} found`, NaviErrorTypes.GENERAL);\n    return experiment;\n  }\n\n  private getVariation(experiment: Experiment): Variation {\n    const variationName = experiment.getActivatedVariationName();\n    const variation = experiment.variations.find((variation) => variation.name === variationName);\n\n    if (!variation)\n      throw new NaviError(\n        `No variation in experiment: ${experiment.name} with name: ${variationName} found`,\n        NaviErrorTypes.GENERAL\n      );\n    return variation;\n  }\n\n  private getClient(): MatomoClient {\n    if (!this.client) throw new NaviError('No client is set, you must call init first', NaviErrorTypes.GENERAL);\n    return this.client;\n  }\n\n  private injectScript(): Promise<boolean> {\n    return new Promise((resolve, reject) => {\n      const s = document.createElement('script');\n      s.text = this.getMatomoScript();\n      document.head.appendChild(s);\n\n      const matomoScript = getHTMLElement(\n        document.querySelector('script[src=\"//cdn.matomo.cloud/porsche.matomo.cloud/matomo.js\"]')\n      );\n\n      if (matomoScript) {\n        matomoScript.onload = () => {\n          resolve(true);\n        };\n        matomoScript.onerror = () => reject(new NaviError('Could not inject Matomo script', NaviErrorTypes.GENERAL));\n      } else {\n        reject(new NaviError('There is no HTML Script element available', NaviErrorTypes.GENERAL));\n      }\n    });\n  }\n\n  private getAbTestingDefinitions() {\n    return experimentsDefinitions;\n  }\n\n  private getMatomoScript(): string {\n    const currentEnvironment = navStateStore.state.env;\n    return `var _paq = window._paq = window._paq || [];\n    _paq.push(['trackPageView']);\n    _paq.push(['enableLinkTracking']);\n    (function() {\n      var u=\"https://porsche.matomo.cloud/\";\n      _paq.push(['setTrackerUrl', u+'matomo.php']);\n      _paq.push(['setSiteId', ${currentEnvironment === 'production' ? '7' : '8'}]);\n      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];\n      g.async=true; g.src='//cdn.matomo.cloud/porsche.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);\n    })\n   ();`;\n  }\n}\n\nexport const MatomoAbTesting = new MatomoAbTestingService();\n","import { IAbTestingService } from './ab-testing-service.interface';\nimport { MatomoAbTesting } from './matomo-ab-testing-service';\n\nexport default function abTestingService(): IAbTestingService {\n  return MatomoAbTesting;\n}\n","import { Content, findMenuItemById, Series, TMenu, TShopMenu } from '../entities/content';\nimport { isCountryInOneOfRegions, splitLocale } from '../entities/locale';\nimport {\n  constructRoutingKey,\n  findTopLevelRoutingKey,\n  getDealerDetailsRoutingKey,\n  getLastRoutingSegment,\n  getModelsRoutingKey,\n  removeLastRoutingSegment,\n  RoutingKey,\n  RoutingKeys\n} from '../entities/routing-key';\nimport { DealerSearchResults, dealerSearchResultsStore } from '../state/dealer-search-results-store';\nimport { navContentStore } from '../state/nav-content-store';\nimport { navStateStore } from '../state/nav-state-store';\nimport { EventAction, EventActions } from '../utility/constants';\nimport { Application } from '../utility/constants/app';\nimport { getUsername, IsLoggedIn, isString } from '../utility/helper';\nimport featureToggles from './feature-toggles';\nimport abTestingService from './ab-testing/ab-testing-constructor-service';\n\nexport type MenuItemProps = {\n  elementId: string;\n  routingKeys: string[];\n  analyticsId: string;\n  text: string;\n  link?: string;\n  subtext?: string;\n  iconRight?: string;\n  showIconModifier?: boolean;\n  datalayerEventAction?: EventAction;\n  onClick?: () => void;\n};\n\nexport function getLevel1Items(\n  content: Content,\n  dealerSearchResults: DealerSearchResults,\n  locale: string,\n  loggedInState: string,\n  unreadMessagesCount: number,\n  userConsentGiven: boolean\n): MenuItemProps[] {\n  const { dealer, models, myPorsche, vehiclePurchase, shop, experience, services } = content;\n  const { savedDealerCookie, ppnDealers } = dealerSearchResults;\n  const { app } = navStateStore.state;\n  const savedDealer = savedDealerCookie !== null ? ppnDealers[savedDealerCookie.id] : undefined;\n\n  // outbound link needed for Singapore market\n  let outboundLink;\n  if (locale === 'en-SG' && dealer.search.outboundLink) {\n    outboundLink = dealer.search.outboundLink?.link;\n  }\n\n  const dealerRoutingKeys: string[] = [RoutingKeys.DEALER_SEARCH];\n\n  if (savedDealer !== undefined && dealerSearchResultsStore.state.results?.length != 1) {\n    dealerRoutingKeys.push(getDealerDetailsRoutingKey(savedDealer.ppnDealer.id));\n  }\n\n  const menu: MenuItemProps[] = [\n    {\n      elementId: RoutingKeys.MODELS,\n      routingKeys: [RoutingKeys.MODELS],\n      analyticsId: models.id,\n      text: models.text\n    },\n    {\n      elementId: RoutingKeys.VEHICLE_PURCHASE,\n      routingKeys: [RoutingKeys.VEHICLE_PURCHASE],\n      analyticsId: vehiclePurchase.id,\n      text: vehiclePurchase.text\n    },\n    {\n      elementId: RoutingKeys.SERVICES,\n      routingKeys: [RoutingKeys.SERVICES],\n      analyticsId: services.id,\n      text: services.text\n    },\n    {\n      elementId: RoutingKeys.EXPERIENCE,\n      routingKeys: [RoutingKeys.EXPERIENCE],\n      analyticsId: experience.id,\n      text: experience.text\n    }\n  ];\n\n  const dealerSearch: MenuItemProps = {\n    elementId: RoutingKeys.DEALER_SEARCH,\n    routingKeys: dealerRoutingKeys,\n    analyticsId: dealer.id,\n    text: dealer.text,\n    link: outboundLink,\n    iconRight: locale === 'en-SG' && dealer.search.outboundLink ? 'external' : 'arrow-head-right'\n  };\n\n  if (shop !== null && shop.text !== '') {\n    const shopItem: MenuItemProps = {\n      elementId: RoutingKeys.SHOP,\n      routingKeys: [RoutingKeys.SHOP],\n      analyticsId: shop.id,\n      text: shop.text,\n      link: app !== Application.shop ? shop.link : undefined,\n      datalayerEventAction: EventActions.NAVIGATION_LINK_CLICK,\n      iconRight: 'external'\n    };\n\n    menu.splice(2, 0, shopItem);\n  }\n\n  if (isDealerSearchEnabled(locale, userConsentGiven)) {\n    const savedDealerName =\n      splitLocale(locale).language === 'en'\n        ? savedDealer?.ppnDealer.name\n        : isString(savedDealer?.ppnDealer.nameLocalized)\n        ? savedDealer?.ppnDealer.nameLocalized\n        : savedDealer?.ppnDealer.name;\n\n    if (isString(savedDealerName)) {\n      dealerSearch.subtext = savedDealerName;\n    }\n  } else {\n    dealerSearch.link = dealer.search.map.link;\n    dealerSearch.onClick = undefined;\n  }\n\n  menu.push(dealerSearch);\n\n  if (myPorsche !== null) {\n    const isLoggedIn = IsLoggedIn(loggedInState);\n    const username = isLoggedIn ? getUsername(loggedInState, myPorsche.loggedInFallback) : undefined;\n\n    menu.push({\n      elementId: RoutingKeys.MY_PORSCHE,\n      routingKeys: [RoutingKeys.MY_PORSCHE],\n      analyticsId: myPorsche.id,\n      text: myPorsche.text,\n      subtext: username,\n      showIconModifier: isLoggedIn && unreadMessagesCount > 0\n    });\n  }\n\n  return menu;\n}\n\nexport function getSideDrawerItems(\n  content: Content,\n  dealerSearchResults: DealerSearchResults,\n  locale: string,\n  loggedInState: string,\n  unreadMessagesCount: number,\n  activeRoutingKey: string,\n  userConsentGiven: boolean\n): MenuItemProps[] {\n  const topLevelRoutingKey = findTopLevelRoutingKey(activeRoutingKey);\n\n  switch (topLevelRoutingKey) {\n    case activeRoutingKey:\n      break;\n\n    case RoutingKeys.MODELS:\n      return content.models.series.map((modelsSeries) => ({\n        elementId: getModelsRoutingKey(modelsSeries.id),\n        routingKeys: [getModelsRoutingKey(modelsSeries.id)],\n        analyticsId: modelsSeries.id,\n        text: modelsSeries.name,\n        subtext: modelsSeries.tags.map((tag) => tag.text).join(' | '),\n        renderSignatures: true,\n        datalayerEventAction: EventActions.MODEL_RANGE_CLICK\n      }));\n\n    case RoutingKeys.SHOP:\n    case RoutingKeys.VEHICLE_PURCHASE:\n    case RoutingKeys.SERVICES:\n    case RoutingKeys.EXPERIENCE: {\n      const parentRoutingKey = removeLastRoutingSegment(activeRoutingKey);\n      const menuDrawerParent = getMenuContent(content, parentRoutingKey, topLevelRoutingKey);\n\n      if (menuDrawerParent !== null) {\n        return menuDrawerParent.children.map((childItem) => ({\n          elementId: constructRoutingKey(parentRoutingKey, childItem.id),\n          routingKeys: [constructRoutingKey(parentRoutingKey, childItem.id)],\n          analyticsId: childItem.id,\n          text: childItem.text,\n          link: childItem.link\n        }));\n      }\n\n      break;\n    }\n  }\n\n  return getLevel1Items(content, dealerSearchResults, locale, loggedInState, unreadMessagesCount, userConsentGiven);\n}\n\nexport function getSideDrawerRoutingKey(activeRoutingKey: string): string {\n  const topLevelRoutingKey = findTopLevelRoutingKey(activeRoutingKey);\n\n  switch (topLevelRoutingKey) {\n    case activeRoutingKey: {\n      break;\n    }\n\n    case RoutingKeys.DEALER_SEARCH: {\n      return RoutingKeys.DEALER_SEARCH;\n    }\n\n    case RoutingKeys.MODELS: {\n      return RoutingKeys.MODELS;\n    }\n\n    case RoutingKeys.SHOP:\n    case RoutingKeys.VEHICLE_PURCHASE:\n    case RoutingKeys.SERVICES:\n    case RoutingKeys.EXPERIENCE: {\n      const parentRoutingKey = removeLastRoutingSegment(activeRoutingKey);\n      return getLastRoutingSegment(parentRoutingKey);\n    }\n  }\n  return RoutingKeys.MAIN_MENU;\n}\n\nexport function getMenuContent(\n  content: Content,\n  routingKey: string,\n  topLevelRoutingKey: string\n): TMenu | TShopMenu | null {\n  const { vehiclePurchase, experience, shop, legacyMore, services } = content;\n\n  const menuContent: TMenu | undefined | null = {\n    [RoutingKeys.VEHICLE_PURCHASE]: vehiclePurchase,\n    [RoutingKeys.EXPERIENCE]: experience,\n    [RoutingKeys.SHOP]: shop,\n    [RoutingKeys.MORE]: legacyMore,\n    [RoutingKeys.SERVICES]: services\n  }[topLevelRoutingKey];\n\n  if (menuContent === undefined || menuContent === null) {\n    return null;\n  }\n  if (isString(menuContent.experienceName)) {\n    menuContent.children = abTestingService().executeContentChange(menuContent);\n  }\n\n  const idOfLastRoutingSegment: string = getLastRoutingSegment(routingKey);\n  return idOfLastRoutingSegment === topLevelRoutingKey\n    ? menuContent\n    : findMenuItemById(menuContent, idOfLastRoutingSegment);\n}\n\nexport function isDealerSearchEnabled(locale: string, userConsentGiven: boolean): boolean {\n  try {\n    const { country } = splitLocale(locale);\n    const returnDealerSearch = !isCountryInOneOfRegions(country) && userConsentGiven;\n\n    return (featureToggles.isDealerSearchChinaEnabled() || country !== 'CN') && returnDealerSearch;\n  } catch {\n    // ignore error\n  }\n  return true;\n}\n\nexport function getBackButtonText(content: Content, previousRoutingKey: string): string {\n  if (!isString(previousRoutingKey)) {\n    return '';\n  }\n\n  const topLevelRoutingKey = findTopLevelRoutingKey(previousRoutingKey);\n\n  switch (topLevelRoutingKey) {\n    case RoutingKeys.MODELS: {\n      return content.models.text;\n    }\n\n    case RoutingKeys.DEALER_SEARCH:\n      if (content.dealer.numberOfDealers === 1) {\n        return '';\n      }\n      return content.dealer.details.backToSearch;\n\n    case RoutingKeys.SHOP:\n    case RoutingKeys.VEHICLE_PURCHASE:\n    case RoutingKeys.MORE:\n    case RoutingKeys.EXPERIENCE: {\n      const menuContent = getMenuContent(navContentStore.state, previousRoutingKey, topLevelRoutingKey);\n\n      if (menuContent !== null) {\n        return menuContent.text;\n      }\n\n      break;\n    }\n  }\n\n  return '';\n}\n\nexport function getHeadlineText(content: Content, routingKey: string, topLevelRoutingKey: string): string {\n  const { dealer, myPorsche, models, vehiclePurchase, experience, shop, legacyMore, services } = content;\n  let menuContent: TMenu | undefined | null | Series;\n  switch (topLevelRoutingKey) {\n    case RoutingKeys.MORE:\n    case RoutingKeys.SHOP:\n    case RoutingKeys.EXPERIENCE:\n    case RoutingKeys.SERVICES:\n    case RoutingKeys.VEHICLE_PURCHASE: {\n      menuContent = {\n        [RoutingKeys.VEHICLE_PURCHASE]: vehiclePurchase,\n        [RoutingKeys.EXPERIENCE]: experience,\n        [RoutingKeys.SHOP]: shop,\n        [RoutingKeys.MORE]: legacyMore,\n        [RoutingKeys.SERVICES]: services\n      }[topLevelRoutingKey];\n\n      if (menuContent === undefined) {\n        return '';\n      }\n\n      const idOfLastRoutingSegment: string = getLastRoutingSegment(routingKey);\n      return idOfLastRoutingSegment === topLevelRoutingKey\n        ? (menuContent?.text as string)\n        : (findMenuItemById(menuContent, idOfLastRoutingSegment)?.text as string);\n    }\n    case RoutingKeys.SERIES:\n    case RoutingKeys.MODELS: {\n      const routingId = getLastRoutingSegment(routingKey);\n      menuContent = models.series.find((modelsSeries) => routingId === modelsSeries.id);\n\n      return menuContent === undefined ? models.text : menuContent?.id;\n    }\n    case RoutingKeys.DEALER_SEARCH: {\n      return dealer.search.text;\n    }\n    case RoutingKeys.MY_PORSCHE: {\n      return myPorsche?.text as string;\n    }\n  }\n  return '';\n}\n\nexport function getSubtext(\n  topLevelRoutingKey?: RoutingKey,\n  activeRoutingKey?: string,\n  locale?: string\n): string | undefined {\n  const { myPorsche, models } = navContentStore.state;\n  const { loggedInState } = navStateStore.state;\n\n  if (topLevelRoutingKey === RoutingKeys.MY_PORSCHE) {\n    const isLoggedIn = IsLoggedIn(loggedInState);\n    return isLoggedIn ? getUsername(loggedInState, myPorsche?.loggedInFallback || '') : '';\n  }\n\n  if (topLevelRoutingKey === RoutingKeys.DEALER_SEARCH) {\n    const { savedDealerCookie, ppnDealers } = dealerSearchResultsStore.state;\n    const savedDealer = savedDealerCookie !== null ? ppnDealers[savedDealerCookie.id] : undefined;\n    const savedDealerName =\n      locale && splitLocale(locale).language === 'en'\n        ? savedDealer?.ppnDealer.name\n        : isString(savedDealer?.ppnDealer.nameLocalized)\n        ? savedDealer?.ppnDealer.nameLocalized\n        : savedDealer?.ppnDealer.name;\n\n    return savedDealerCookie ? savedDealerName : '';\n  }\n\n  if (topLevelRoutingKey === RoutingKeys.MODELS) {\n    if (isString(activeRoutingKey)) {\n      const routingId = getLastRoutingSegment(activeRoutingKey);\n      const menuContent = models.series.find((modelsSeries) => routingId === modelsSeries.id);\n      if (menuContent) {\n        return menuContent.tags.map((tag) => tag.text).join(' | ');\n      }\n    }\n  }\n\n  return '';\n}\n","import { BodyType } from '../../entities/content';\nimport { determineMainDrawerLevel, getLastRoutingSegment, getPreviousRoutingKey } from '../../entities/routing-key';\nimport { routerStore } from '../../state/router-store';\nimport { DEALER_SEARCH_ELEMENT_TYPE, DisplayElementType, ElementType, ElementTypes } from '../../utility/constants';\nimport { isString } from '../../utility/helper';\nimport { getSideDrawerRoutingKey } from '../menu-items-service';\n\nconst state: {\n  drawerType?: DisplayElementType;\n  elementType?: ElementType;\n} = {};\n\nfunction setDrawerType(drawerType: DisplayElementType): void {\n  state.drawerType = drawerType;\n}\n\nfunction calculateDisplayElementId(routingKeyForNavigatingForward?: string): string {\n  const { drawerType } = state;\n  const mainDrawerRoutingKey =\n    (isString(routingKeyForNavigatingForward)\n      ? getPreviousRoutingKey(routingKeyForNavigatingForward)\n      : routerStore.state.routingKeyHistory[routerStore.state.routingKeyPointer]) || '';\n  const lastMainDrawerRoutingKey = getLastRoutingSegment(mainDrawerRoutingKey);\n  const mainDrawerLevel = determineMainDrawerLevel(mainDrawerRoutingKey);\n  const sideDrawerLevel = mainDrawerLevel - 1;\n\n  if (!isString(mainDrawerRoutingKey)) {\n    return 'level0';\n  }\n\n  const mainDrawerDisplayElementId = isString(mainDrawerRoutingKey)\n    ? `level${mainDrawerLevel}-${lastMainDrawerRoutingKey}`\n    : `level${mainDrawerLevel - 1}-unknown`;\n\n  if (drawerType === 'doubleDrawer') {\n    if (mainDrawerRoutingKey === '') {\n      return `level${sideDrawerLevel}-unknown_level${mainDrawerLevel}-unknown`;\n    }\n    const sideDrawerRoutingKey = getSideDrawerRoutingKey(mainDrawerRoutingKey);\n    return `level${sideDrawerLevel}-${sideDrawerRoutingKey}_${mainDrawerDisplayElementId}`;\n  }\n\n  return mainDrawerDisplayElementId;\n}\n\nfunction calculateDisplayElementType(\n  activeRoutingKey: string,\n  elementType: ElementType,\n  isSideDrawer?: boolean\n): string {\n  const { drawerType } = state;\n  const mainDrawerLevel = determineMainDrawerLevel(activeRoutingKey);\n\n  if (drawerType === 'doubleDrawer') {\n    let sideDrawerLevel = mainDrawerLevel;\n    if (isSideDrawer) {\n      sideDrawerLevel = sideDrawerLevel - 1;\n    }\n    return `level${sideDrawerLevel}_${elementType}`;\n  } else {\n    return isString(activeRoutingKey)\n      ? `level${mainDrawerLevel}_${elementType}`\n      : `level${mainDrawerLevel - 1}_${elementType}`;\n  }\n}\n\nfunction getModelName(bodyType: BodyType): string {\n  const urlSplitIntoPieces: string[] = bodyType.link.split('/');\n  const lastElementInUrlSplit: string = urlSplitIntoPieces[urlSplitIntoPieces.length - 1];\n  let modelName: string;\n\n  if (lastElementInUrlSplit === '') {\n    if (urlSplitIntoPieces[urlSplitIntoPieces.length - 2] === undefined) {\n      modelName = '';\n    } else {\n      modelName = urlSplitIntoPieces[urlSplitIntoPieces.length - 2].split('-').join(' ');\n    }\n  } else {\n    modelName = lastElementInUrlSplit.split('-').join(' ');\n  }\n\n  return modelName;\n}\n\nfunction getModelTargetElement(elementId: string, text: string): string | undefined {\n  if (elementId.includes('models')) {\n    const mainDrawerLevel = determineMainDrawerLevel(elementId);\n\n    return `level${mainDrawerLevel}_${text.toLowerCase()}`;\n  }\n\n  return;\n}\n\nfunction getDrawerType() {\n  return state.drawerType;\n}\n\nfunction getDealerResultsLoadDisplayElementId(elementId: string): string {\n  if (getDrawerType() === 'doubleDrawer') {\n    return elementId;\n  } else {\n    return calculateDisplayElementId();\n  }\n}\n\nfunction getDealerResultsLoadDisplayElementType(): string {\n  if (getDrawerType() === 'doubleDrawer') {\n    return DEALER_SEARCH_ELEMENT_TYPE;\n  } else {\n    return calculateDisplayElementType('', ElementTypes.dealerSearchForm);\n  }\n}\n\nexport default {\n  setDrawerType,\n  getDealerResultsLoadDisplayElementId,\n  calculateDisplayElementId,\n  getDealerResultsLoadDisplayElementType,\n  calculateDisplayElementType,\n  getModelName,\n  getModelTargetElement\n};\n"],"version":3}