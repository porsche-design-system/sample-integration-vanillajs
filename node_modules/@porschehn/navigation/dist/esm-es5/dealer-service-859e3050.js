var __awaiter=this&&this.__awaiter||function(e,r,t,n){function a(e){return e instanceof t?e:new t((function(r){r(e)}))}return new(t||(t=Promise))((function(t,o){function i(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n["throw"](e))}catch(e){o(e)}}function c(e){e.done?t(e.value):a(e.value).then(i,s)}c((n=n.apply(e,r||[])).next())}))};var __generator=this&&this.__generator||function(e,r){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,a,o,i;return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(r){return c([e,r])}}function c(s){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,s[0]&&(t=0)),t)try{if(n=1,a&&(o=s[0]&2?a["return"]:s[0]?a["throw"]||((o=a["return"])&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;if(a=0,o)s=[s[0]&2,o.value];switch(s[0]){case 0:case 1:o=s;break;case 4:t.label++;return{value:s[1],done:false};case 5:t.label++;a=s[1];s=[0];continue;case 7:s=t.ops.pop();t.trys.pop();continue;default:if(!(o=t.trys,o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){t=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){t.label=s[1];break}if(s[0]===6&&t.label<o[1]){t.label=o[1];o=s;break}if(o&&t.label<o[2]){t.label=o[2];t.ops.push(s);break}if(o[2])t.ops.pop();t.trys.pop();continue}s=r.call(e,t)}catch(e){s=[6,e];a=0}finally{n=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var __spreadArray=this&&this.__spreadArray||function(e,r,t){if(t||arguments.length===2)for(var n=0,a=r.length,o;n<a;n++){if(o||!(n in r)){if(!o)o=Array.prototype.slice.call(r,0,n);o[n]=r[n]}}return e.concat(o||Array.prototype.slice.call(r))};import{c as Environments,N as NaviError,a as NaviErrorTypes,n as navStateStore}from"./nav-content-store-238e6137.js";import{w as windowService}from"./feature-toggles-f5a05f06.js";import{b as getQueryString,a as getConfig}from"./helper-76937d0b.js";var __rest=undefined&&undefined.__rest||function(e,r){var t={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0)t[n]=e[n];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++){if(r.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a]))t[n[a]]=e[n[a]]}return t};function getAllPPNDealersForMarket(e,r,t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,getPPNDealers(e,r,{latitude:0,longitude:0},t,{radius:1e7})]}))}))}function getPPNDealers(e,r,t,n,a){if(a===void 0){a={}}return __awaiter(this,void 0,void 0,(function(){var o,i,s,c,u,l,f;return __generator(this,(function(d){switch(d.label){case 0:o=a.radius;d.label=1;case 1:d.trys.push([1,3,,4]);c=new Headers;c.set("Accept","*/*");if(e===Environments.LOCAL){c.set("Authorization","Basic "+windowService.btoa("".concat("undefined",":").concat("undefined")))}u={coordinates:"".concat(t.latitude,",").concat(t.longitude),radius:o};return[4,fetch("".concat(r,"/").concat(n,"/dealers?").concat(getQueryString(u)),{method:"GET",headers:c})];case 2:i=d.sent();return[3,4];case 3:l=d.sent();throw new NaviError("Unable to fetch dealers",NaviErrorTypes.GENERAL);case 4:if(i.status===400){throw new NaviError("dealerService.getPPNDealers failed with invalid coordinates",NaviErrorTypes.GENERAL)}if(i.status===404){throw new NaviError("dealerService.getPPNDealers failed with invalid country code and therefore responded with no results",NaviErrorTypes.NO_RESULTS)}if(i.status!==200){throw new NaviError("dealerService.getPPNDealers failed with invalid response",NaviErrorTypes.GENERAL)}d.label=5;case 5:d.trys.push([5,7,,8]);return[4,i.json()];case 6:s=d.sent();return[3,8];case 7:f=d.sent();throw new NaviError("dealerService.getPPNDealers could not parse response into json format",NaviErrorTypes.GENERAL);case 8:return[2,s.map((function(e){var r=e.dealer,t=__rest(e,["dealer"]);return Object.assign({ppnDealer:r},t)}))]}}))}))}function getPPNDealer(e,r,t,n,a){return __awaiter(this,void 0,void 0,(function(){var o,i,s;return __generator(this,(function(c){switch(c.label){case 0:c.trys.push([0,2,,3]);return[4,getPPNDealers(e,r,n,a)];case 1:i=c.sent();o=i.find((function(e){return t===e.ppnDealer.id}));return[3,3];case 2:s=c.sent();throw new NaviError("Unable to fetch a dealer",NaviErrorTypes.GENERAL);case 3:if(o===undefined){throw new NaviError("Requested dealer ".concat(t," could not be found"),NaviErrorTypes.NO_RESULTS)}return[2,o]}}))}))}var dealersByRegionMap=new Map;function getPPNDealerByRegion(e,r){return __awaiter(this,void 0,void 0,(function(){var t,n;return __generator(this,(function(a){switch(a.label){case 0:return[4,getPPNDealersByRegion(r)];case 1:t=a.sent();n=t.regions.flatMap((function(e){var r=e.cities;return r.flatMap((function(e){var r=e.dealers;return Object.values(r).reduce((function(e,r){return __spreadArray(__spreadArray([],e,true),[r],false)}),[])}))})).find((function(r){var t=r.ppnDealer;return t.id===e}));if(n===undefined){throw new NaviError("Requested dealer could not be found",NaviErrorTypes.NO_RESULTS)}return[2,n]}}))}))}function getPPNDealersByRegion(e){return __awaiter(this,void 0,void 0,(function(){var r,t,n,a,o;return __generator(this,(function(i){switch(i.label){case 0:r=navStateStore.state.env;t=new Headers;if(!dealersByRegionMap.has(e))return[3,1];n=dealersByRegionMap.get(e);return[3,4];case 1:a=getConfig(r).BFF_ENDPOINT;t.set("Accept","*/*");return[4,fetch("".concat(a,"/dealers/region/").concat(e,"?env=").concat(r),{method:"GET",headers:t})];case 2:o=i.sent();return[4,o.json()];case 3:n=i.sent();dealersByRegionMap.set(e,n);i.label=4;case 4:if(n===undefined){throw new NaviError("Requested dealer could not be found",NaviErrorTypes.NO_RESULTS)}return[2,n]}}))}))}export{getPPNDealer as a,getAllPPNDealersForMarket as b,getPPNDealersByRegion as c,getPPNDealers as d,getPPNDealerByRegion as g};
//# sourceMappingURL=dealer-service-859e3050.js.map