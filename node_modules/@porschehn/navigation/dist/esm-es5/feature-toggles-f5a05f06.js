var __awaiter=this&&this.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o["throw"](e))}catch(e){i(e)}}function l(e){e.done?n(e.value):r(e.value).then(a,s)}l((o=o.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},o,r,i,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return l([e,t])}}function l(s){if(o)throw new TypeError("Generator is already executing.");while(a&&(a=0,s[0]&&(n=0)),n)try{if(o=1,r&&(i=s[0]&2?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;if(r=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;r=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];r=0}finally{o=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};import{N as NaviError,a as NaviErrorTypes,c as Environments,n as navStateStore,g as getEnvironment}from"./nav-content-store-238e6137.js";import{o as breakpoint,u as hasKey,g as getString,C as COOKIE_DOMAIN,M as MS_IN_MONTH,x as shallowCopySpecifiedAttributesWithDefault,y as camelToKebapCase,i as isString,t as getHTMLElement,V as VERSION,v as DEFAULT_ENVIRONMENT,a as getConfig}from"./helper-76937d0b.js";var FEATURE_OVERRIDE_ENABLED="featureOverrideEnabled";var FEATURE_SHOP="shop";var FEATURE_PCOM_SEARCH="pcom_search";var FEATURE_SAVED_ITEMS="saved_items";var FEATURE_AB_TESTING="ab";var FEATURE_DEALER_SEARCH_CHINA="dealer_search_china";var FEATURE_DEALER_SEARCH_OPENING_HOURS="opening_hours";var FEATURE_SENTRY="sentry";var FEATURE_SHOP_WISHLIST="shop_wishlist";var local={featureOverrideEnabled:{enabled:true},homenav_1723:{enabled:true},navi_3:{enabled:false},porsche_75_years_logo:{enabled:false},one_ui:{enabled:false},mock_shop_content:{enabled:false},shop:{enabled:false},pcom_search:{enabled:false},shop_wishlist:{enabled:false}};var preview={featureOverrideEnabled:{enabled:true},homenav_1723:{enabled:true},navi_3:{enabled:false},porsche_75_years_logo:{enabled:false},one_ui:{enabled:false},mock_shop_content:{enabled:false},shop:{enabled:false},pcom_search:{enabled:false},shop_wishlist:{enabled:false}};var test={featureOverrideEnabled:{enabled:true},homenav_1723:{enabled:true},navi_3:{enabled:true},porsche_75_years_logo:{enabled:false},one_ui:{enabled:false},mock_shop_content:{enabled:false},shop:{enabled:false},pcom_search:{enabled:false},shop_wishlist:{enabled:false}};var production={featureOverrideEnabled:{enabled:false},homenav_1723:{enabled:false},navi_3:{enabled:true},porsche_75_years_logo:{enabled:false},mock_shop_content:{enabled:false},shop:{enabled:false},pcom_search:{enabled:false},shop_wishlist:{enabled:false}};var featureJson={local:local,preview:preview,test:test,production:production};var WindowService=function(){function e(){this.initialBodyStyleValues={top:"",position:"",inlineSize:"",overflowY:""};this.initialDocumentScrollTop=0}Object.defineProperty(e.prototype,"location",{get:function(){return window.location},set:function(e){window.location=e},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"sessionStorage",{get:function(){return window.sessionStorage},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"localStorage",{get:function(){return window.localStorage},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"version",{set:function(e){Object.assign(window,{PHN_HEADER_VERSION:e})},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"navigationLoaded",{set:function(e){Object.assign(window,{PHN_NAVIGATION_LOADED:e})},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"bodyOverflow",{get:function(){return document.body.style.overflow},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"bodyHeight",{get:function(){return document.body.style.height},enumerable:false,configurable:true});e.prototype.requestAnimationFrame=function(e){return window.requestAnimationFrame(e)};e.prototype.createDiv=function(){return window.document.createElement("div")};e.prototype.getBreakpoint=function(){var e=Math.max(window.document.documentElement.clientWidth,window.innerWidth||0);var t=Object.keys(breakpoint).reverse().find((function(t){return hasKey(breakpoint,t)&&e>=breakpoint[t]}));return typeof t==="string"&&hasKey(breakpoint,t)?breakpoint[t]:0};Object.defineProperty(e.prototype,"redirected",{get:function(){return window.REDIRECTED===true||window.location.search.includes("cs_redirect=")},enumerable:false,configurable:true});e.prototype.createIframe=function(e,t){var n=window.document.createElement("iframe");n.id=e;n.style.display="none";n.src=t;window.document.body.appendChild(n)};e.prototype.removeElement=function(e){var t;(t=window.document.getElementById(e))===null||t===void 0?void 0:t.remove()};e.prototype.redirectToUrl=function(e){window.location.assign(e)};e.prototype.generateRandom=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";var n=new Uint8Array(e);window.crypto.getRandomValues(n);var o=[];for(var r=0;r<n.byteLength;r+=1){var i=n[r]%t.length;o.push(t[i])}return o.join("")};e.prototype.maybeCheckMarketingConsent=function(e){var t,n,o,r,i,a,s,l,c,u,d;var f={processorId:(o=(n=(t=window.GlobalConsent)===null||t===void 0?void 0:t.Processor)===null||n===void 0?void 0:n.googleMaps)!==null&&o!==void 0?o:"Google Maps",timeoutVar:{},mapContainer:"",callbacks:{success:e}};if(typeof((i=(r=window.PCOM)===null||r===void 0?void 0:r.globalConsent)===null||i===void 0?void 0:i.checkConsent)==="function"){(l=(s=(a=window.PCOM)===null||a===void 0?void 0:a.globalConsent)===null||s===void 0?void 0:s.checkConsent)===null||l===void 0?void 0:l.call(s,f);return true}if(typeof((c=window.ucPrivacyShield)===null||c===void 0?void 0:c.checkConsent)==="function"){(d=(u=window.ucPrivacyShield)===null||u===void 0?void 0:u.checkConsent)===null||d===void 0?void 0:d.call(u,f);return true}e();return false};e.prototype.deriveChallenge=function(e){return __awaiter(this,void 0,void 0,(function(){var t,n,o,r,i,a,o;return __generator(this,(function(s){switch(s.label){case 0:if(e.length<43||e.length>128){throw new NaviError("invalid code length",NaviErrorTypes.INVALID_INPUT)}t=new ArrayBuffer(e.length);n=new Uint8Array(t);for(o=0;o<e.length;o++){n[o]=e.charCodeAt(o)}return[4,window.crypto.subtle.digest("SHA-256",n)];case 1:r=s.sent();i=new Uint8Array(r);a="";for(o=0;o<i.byteLength;o++){a+=String.fromCharCode(i[o])}return[2,window.btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")]}}))}))};e.prototype.hashString=function(e){return __awaiter(this,void 0,void 0,(function(){var t,n,o;return __generator(this,(function(r){switch(r.label){case 0:t=(new TextEncoder).encode(e);return[4,window.crypto.subtle.digest("SHA-256",t)];case 1:n=r.sent();o=Array.from(new Uint8Array(n));return[2,o.map((function(e){return e.toString(16).padStart(2,"0")})).join("")]}}))}))};e.prototype.getScrollbarWidth=function(){var e=window.document.createElement("div");e.style.overflow="scroll";window.document.body.appendChild(e);var t=e.offsetWidth-e.clientWidth;window.document.body.removeChild(e);return Number.isNaN(t)?"0px":"".concat(t,"px")};e.prototype.fetchGoogleMapsApi=function(e,t){if(t===void 0){t="https://maps.googleapis.com/maps/api/js?key=".concat(e,"&libraries=places")}return __awaiter(this,void 0,void 0,(function(){var e,n;return __generator(this,(function(o){if(window.google!==undefined&&window.google.maps!==undefined&&window.google.maps.version!==undefined){return[2,window.google]}e=document.getElementById("googleMaps");if(e){return[2,window.google]}n=document.createElement("script");n.src=t;n.id="googleMaps";document.head.appendChild(n);return[2,new Promise((function(e,t){n.onerror=function(){t(new NaviError("Failed to load google maps script.",NaviErrorTypes.GENERAL))};n.onload=function(){e(window.google)}}))]}))}))};e.prototype.getNavigatorLatLong=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,new Promise((function(e,t){window.navigator.geolocation.getCurrentPosition((function(t){var n=t.coords,o=n.latitude,r=n.longitude;e({latitude:o,longitude:r})}),(function(e){return t(new NaviError("geolocation.getCurrentPosition failed with ".concat(e.code,": ").concat(e.message),getErrorType(e)))}))}))]}))}))};e.prototype.getCookie=function(e){var t;return getString((t=document.cookie.split("; ").find((function(t){return t.startsWith("".concat(e,"="))})))===null||t===void 0?void 0:t.split("=")[1])};e.prototype.setCookie=function(e,t){document.cookie="".concat(e,"=").concat(t,";domain=").concat(COOKIE_DOMAIN,";expires=").concat(new Date(Date.now()+MS_IN_MONTH*10).toUTCString(),";")};e.prototype.btoa=function(e){return window.btoa(e)};e.prototype.lockScroll=function(){this.initialBodyStyleValues=shallowCopySpecifiedAttributesWithDefault(document.body.style,this.initialBodyStyleValues);this.initialDocumentScrollTop=document.documentElement.scrollTop;document.body.style.top="-".concat(document.documentElement.scrollTop,"px");document.body.style.position="fixed";document.body.style.inlineSize="100%";document.body.style.overflowY="scroll"};e.prototype.unlockScroll=function(){Object.entries(this.initialBodyStyleValues).forEach((function(e){var t=e[0],n=e[1];return document.body.style.setProperty(camelToKebapCase(t),n)}));document.documentElement.scrollTop=this.initialDocumentScrollTop};e.prototype.hasScrollbar=function(){return window.document.body.offsetHeight>window.innerHeight};e.prototype.waitForElement=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(o){if(!isString(t)){return[2,e]}n=getHTMLElement(e.querySelector(t));if(n!==null){return[2,n]}return[2,new Promise((function(n){var o=new MutationObserver((function(){var r=getHTMLElement(e.querySelector(t));if(r!==null){n(r);o.disconnect()}}));o.observe(e,{childList:true,subtree:true})}))]}))}))};return e}();function getErrorType(e){switch(e.code){case e.PERMISSION_DENIED:{return NaviErrorTypes.GEOLOCATION_DENIED}case e.POSITION_UNAVAILABLE:case e.TIMEOUT:{return NaviErrorTypes.RETRY}default:{return NaviErrorTypes.GENERAL}}}var windowService=new WindowService;var Logger=function(){function e(){this.version=VERSION;this.breakpoint=0;this.locale=null}e.prototype.init=function(e,t){this.breakpoint=windowService.getBreakpoint();this.locale=t};e.prototype.log=function(e,t,n,o,r){var i=navStateStore.state.env;if(i===Environments.TEST){return}try{var a=JSON.stringify({name:e,level:t,env:i,breakpoint:this.breakpoint,locale:this.locale,version:this.version,hostname:windowService.location.hostname,pathname:windowService.location.pathname,id:n,errorType:r||"",message:o});if(i!==Environments.PRODUCTION){console[t](a)}}catch(e){}};e.prototype.info=function(e,t){if(t===void 0){t=""}this.log("PHN_HEADER_LOG_ENTRY","info",e,t)};e.prototype.error=function(e,t){var n=t instanceof NaviError?t.type:NaviErrorTypes.GENERAL;this.log("PHN_HEADER_LOG_ENTRY","error",e,t.message,n)};return e}();var logger=new Logger;var FeatureToggles=function(){function e(e,t){var n=this;if(e===void 0){e=getEnvironment(DEFAULT_ENVIRONMENT)}if(t===void 0){t=featureJson}this.featureEnvMap=t;this.features={};this.env="local";this.isShopToggleActive=function(){return n.isFeatureEnabled(FEATURE_SHOP,windowService.location.search)};this.isPcomSearchToggleActive=function(){return n.isFeatureEnabled(FEATURE_PCOM_SEARCH,windowService.location.search)};this.isSavedItemsToggleActive=function(){return n.isFeatureEnabled(FEATURE_SAVED_ITEMS,windowService.location.search)};this.isABTestingToggleActive=function(){return n.isFeatureEnabled(FEATURE_AB_TESTING,windowService.location.search)};this.isDealerSearchChinaEnabled=function(){return n.isFeatureEnabled(FEATURE_DEALER_SEARCH_CHINA,windowService.location.search)};this.isDealerSearchOpeningHoursEnabled=function(){return n.isFeatureEnabled(FEATURE_DEALER_SEARCH_OPENING_HOURS,windowService.location.search)};this.isSentryEnabled=function(){return n.isFeatureEnabled(FEATURE_SENTRY,windowService.location.search)};this.isShopWishlistToggleActive=function(){return n.isFeatureEnabled(FEATURE_SHOP_WISHLIST,windowService.location.search)};this.env=e;this.features=this.featureEnvMap[e]}e.prototype.loadRemoteToggles=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,n,o,r;return __generator(this,(function(i){switch(i.label){case 0:i.trys.push([0,5,,6]);e=getConfig(this.env).BFF_ENDPOINT;return[4,fetch("".concat(e,"/toggles?env=").concat(this.env))];case 1:t=i.sent();if(!!t.ok)return[3,3];return[4,t.text()];case 2:n=i.sent();throw new Error(n);case 3:return[4,t.json()];case 4:o=i.sent();this.features=o;return[3,6];case 5:r=i.sent();throw new NaviError("Load Feature Toggles failed with error: ".concat(r),NaviErrorTypes.GENERAL);case 6:return[2]}}))}))};e.prototype.stringToBooleanStrict=function(e){if(e==="true"){return true}if(e==="false"){return false}return null};e.prototype.getUrlFeatureToggleOverride=function(e,t){var n,o;var r=(o=(n=t.split("?")[1])===null||n===void 0?void 0:n.split("&").find((function(t){return t.includes(e)})))===null||o===void 0?void 0:o.split("=")[1];return isString(r)?this.stringToBooleanStrict(r||""):null};e.prototype.getLocalStorageFeatureToggleOverride=function(e){var t=localStorage.getItem("phn.".concat(e));return isString(t)?this.stringToBooleanStrict(t):null};e.prototype.isFeatureEnabled=function(e,t){var n;if(this.features===undefined){return false}if(this.env===Environments.PRODUCTION&&this.isOnSecurityLayer(e)){return false}if((n=this.features[FEATURE_OVERRIDE_ENABLED])===null||n===void 0?void 0:n.enabled){var o=[this.getUrlFeatureToggleOverride(e,t),this.getLocalStorageFeatureToggleOverride(e)];for(var r=0,i=o;r<i.length;r++){var a=i[r];if(a!==null){return a}}}if(this.features[e]!==undefined){return this.features[e].enabled}else{return false}};e.prototype.setFeatures=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:this.env=e;n.label=1;case 1:n.trys.push([1,3,,4]);if(e==="test"){this.features=this.featureEnvMap[e];return[2]}return[4,this.loadRemoteToggles()];case 2:n.sent();return[3,4];case 3:t=n.sent();logger.error("INIT_APP_CONFIG",t);this.features=this.featureEnvMap[e];return[3,4];case 4:return[2]}}))}))};e.prototype.isOnSecurityLayer=function(e){var t=[FEATURE_SENTRY,FEATURE_DEALER_SEARCH_OPENING_HOURS];return t.includes(e)};return e}();var featureToggles=new FeatureToggles;export{featureToggles as f,logger as l,windowService as w};
//# sourceMappingURL=feature-toggles-f5a05f06.js.map