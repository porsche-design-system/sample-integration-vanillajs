var __awaiter=this&&this.__awaiter||function(e,t,r,n){function i(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n["throw"](e))}catch(e){o(e)}}function c(e){e.done?r(e.value):i(e.value).then(a,s)}c((n=n.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return c([e,t])}}function c(s){if(n)throw new TypeError("Generator is already executing.");while(a&&(a=0,s[0]&&(r=0)),r)try{if(n=1,i&&(o=s[0]&2?i["return"]:s[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;if(i=0,o)s=[s[0]&2,o.value];switch(s[0]){case 0:case 1:o=s;break;case 4:r.label++;return{value:s[1],done:false};case 5:r.label++;i=s[1];s=[0];continue;case 7:s=r.ops.pop();r.trys.pop();continue;default:if(!(o=r.trys,o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(s[0]===6&&r.label<o[1]){r.label=o[1];o=s;break}if(o&&r.label<o[2]){r.label=o[2];r.ops.push(s);break}if(o[2])r.ops.pop();r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e];i=0}finally{n=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};import{d as createStore,a as navContentStore,n as navStateStore}from"./nav-content-store-ad934a75.js";import{w as windowService}from"./window-service-890948e7.js";import{S as SAVED_DEALER_COOKIE,N as NaviError,a as NaviErrorTypes,u as getHTMLElement}from"./navi-error-d2e07707.js";import{f as featureToggles,l as logger}from"./feature-toggles-1274e59b.js";var dealerSearchResultsStore=createStore({searchTerm:"",results:null,savedDealerCookie:readDealerCookie(),ppnDealers:{},dealersOfRegion:{regions:[]}});dealerSearchResultsStore.onChange("savedDealerCookie",(function(e){windowService.setCookie(SAVED_DEALER_COOKIE,JSON.stringify(e))}));function readDealerCookie(){try{return JSON.parse(windowService.getCookie(SAVED_DEALER_COOKIE))}catch(e){return null}}var experimentsDefinitions={};var MatomoAbTestingService=function(){function e(){this.client=null;this.experiments=[]}e.prototype.init=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:if(!featureToggles.isABTestingToggleActive())return[3,5];t.label=1;case 1:t.trys.push([1,4,,5]);return[4,this.setClient()];case 2:t.sent();return[4,this.loadExperiments()];case 3:t.sent();return[3,5];case 4:e=t.sent();logger.error("Could not initialize AbTesting",e);return[3,5];case 5:return[2]}}))}))};e.prototype.execute=function(e){if(featureToggles.isABTestingToggleActive()){try{var t=this.getExperiment(e);var r=this.getVariation(t);r.activate()}catch(t){logger.error("Could not execute experiment ".concat(e),t)}}};e.prototype.executeContentChange=function(e){if(featureToggles.isABTestingToggleActive()){try{var t=this.getExperiment(e.experienceName);var r=this.getVariation(t);if(r.name==="original"){return e.children}return r.activate()}catch(t){logger.error("Could not execute experiment ".concat(e.experienceName),t)}}return e.children};e.prototype.setClient=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:if(this.client)return[2,Promise.resolve(this.client)];return[4,this.injectScript()];case 1:t.sent();e=window;this.client=e.Matomo;return[2,this.client]}}))}))};e.prototype.loadExperiments=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,r,n,i,o;return __generator(this,(function(a){e=this.getClient();t=e.AbTesting.Experiment;r=this.getAbTestingDefinitions();for(n in r){i=r[n];o=new t(i);this.experiments.push(o)}return[2]}))}))};e.prototype.loadContentGeneratorExperiments=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,r,n,i,o,a,s;return __generator(this,(function(c){if(featureToggles.isABTestingToggleActive()){e=this.getClient();t=e.AbTesting.Experiment;r=navContentStore.state.abExperiences;if(r){for(n=0,i=r;n<i.length;n++){o=i[n];a=o.variations.map((function(e){return{name:e.name,activate:function(){return e.children}}}));a.push({name:"original",activate:function(){return null}});s=new t(Object.assign(Object.assign({},o),{variations:a}));this.experiments.push(s)}}}return[2]}))}))};e.prototype.getExperiment=function(e){var t=this.experiments.find((function(t){return t.name===e}));if(!t)throw new NaviError("No experiment with name: ".concat(e," found"),NaviErrorTypes.GENERAL);return t};e.prototype.getVariation=function(e){var t=e.getActivatedVariationName();var r=e.variations.find((function(e){return e.name===t}));if(!r)throw new NaviError("No variation in experiment: ".concat(e.name," with name: ").concat(t," found"),NaviErrorTypes.GENERAL);return r};e.prototype.getClient=function(){if(!this.client)throw new NaviError("No client is set, you must call init first",NaviErrorTypes.GENERAL);return this.client};e.prototype.injectScript=function(){var e=this;return new Promise((function(t,r){var n=document.createElement("script");n.text=e.getMatomoScript();document.head.appendChild(n);var i=getHTMLElement(document.querySelector('script[src="//cdn.matomo.cloud/porsche.matomo.cloud/matomo.js"]'));if(i){i.onload=function(){t(true)};i.onerror=function(){return r(new NaviError("Could not inject Matomo script",NaviErrorTypes.GENERAL))}}else{r(new NaviError("There is no HTML Script element available",NaviErrorTypes.GENERAL))}}))};e.prototype.getAbTestingDefinitions=function(){return experimentsDefinitions};e.prototype.getMatomoScript=function(){var e=navStateStore.state.env;return"var _paq = window._paq = window._paq || [];\n    _paq.push(['trackPageView']);\n    _paq.push(['enableLinkTracking']);\n    (function() {\n      var u=\"https://porsche.matomo.cloud/\";\n      _paq.push(['setTrackerUrl', u+'matomo.php']);\n      _paq.push(['setSiteId', ".concat(e==="production"?"7":"8","]);\n      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];\n      g.async=true; g.src='//cdn.matomo.cloud/porsche.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);\n    })\n   ();")};return e}();var MatomoAbTesting=new MatomoAbTestingService;function abTestingService(){return MatomoAbTesting}export{abTestingService as a,dealerSearchResultsStore as d};
//# sourceMappingURL=ab-testing-constructor-service-ac142693.js.map