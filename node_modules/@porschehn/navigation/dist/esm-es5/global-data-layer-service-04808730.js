var __extends=this&&this.__extends||function(){var e=function(t,n){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))e[n]=t[n]};return e(t,n)};return function(t,n){if(typeof n!=="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return __assign.apply(this,arguments)};var __rest=this&&this.__rest||function(e,t){var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0)n[r]=e[r];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++){if(t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i]))n[r[i]]=e[r[i]]}return n};var __spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,o;r<i;r++){if(o||!(r in t)){if(!o)o=Array.prototype.slice.call(t,0,r);o[r]=t[r]}}return e.concat(o||Array.prototype.slice.call(t))};import{s as splitLocale,D as DATA_LAYER_APPLICATION_NAME,c as Environments,d as DATA_LAYER_APP_ID}from"./nav-content-store-0a34ed51.js";import{i as isString}from"./helper-baaa661e.js";var M=Object.defineProperty;var W=function(e,t,n){return t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n};var o=function(e,t,n){return W(e,typeof t!="symbol"?t+"":t,n),n};var y={BEFORE_MERGE:"BEFORE_MERGE",AFTER_MERGE:"AFTER_MERGE"},w={clean:{enabled:!1,executionPlace:y.AFTER_MERGE,values:["",void 0,null]},logging:{enabled:!0,level:"warn"},validation:{enabled:!1,allowUnknown:!1,verbose:!0},webProperties:{enabled:!0,eventNamePattern:/.*/,reactiveUrl:!0,reactiveDimensions:!0}};var U=function(){function e(){}e.prototype.create=function(e){return typeof e.event!="string"||e.event.length===0?{}:{context:{eventAction:e.event}}};return e}();var S=function(e,t){var n;for(n in e)if(!(!e||!e[n])&&t(e[n],n)===!1)return!1;return!0},_=function(e,t){return S(e,(function(n,r){for(var i in e[r])if(t(n[i],i,n,r)===!1)return!1;return!0}))},m=function(e){for(var t in e)return!1;return!0},P=function(e,t){if(t===void 0){t=function(e){return(e=w.clean)==null?void 0:e.values}()||[]}return _(e,(function(n,r,i,o){t.includes(n)&&(delete i[r],m(i)&&delete e[o])})),e},G=function(e,t){return e&&(_(e,(function(n,r,i,o){t.includes("".concat(o.toString(),".").concat(r.toString()))&&(delete i[r],m(i)&&delete e[o])})),e)},k=function(e){return _(e,(function(e,t,n){return typeof e!="function"||(n[t]=e()),!0})),e};var B=function(e,t){var n=t.split(".");if(n.length!==2)return;var r=e[n[0]];if(r)return r[n[1]]},C=function(e){if(!e)return[];var t=[];return _(e,(function(e,n,r,i){t.push("".concat(i.toString(),".").concat(n.toString()))})),t},j=w.logging;var x=function(e){return e[e.error=0]="error",e[e.warn=1]="warn",e[e.log=2]="log",e}(x||{});var v=function(){function e(e,t){o(this,"prefix");o(this,"settings");this.prefix=e,this.settings=__assign(__assign({},j),t)}e.prototype._getMergedSettings=function(e){return e?__assign(__assign({},this.settings),e):this.settings};e.prototype._isAllowed=function(t,n){if(!e.isAvailable||!n.enabled)return!1;var r=x[n.level];switch(t){case"error":case"warn":return r>=x[t];case"info":case"log":case"debug":case"dir":return r>=2;default:return!1}};e.prototype._log=function(e,t,n){if(t===void 0){t="log"}var r=this._getMergedSettings(n);if(this._isAllowed(t,r))switch(t){case"dir":console.log("[".concat(this.prefix,"] ").concat(t,":")),console[t](e);break;default:console[t]("[".concat(this.prefix,"] ").concat(e))}};e.prototype.log=function(e,t){this._log(e,"log",t)};e.prototype.dir=function(e,t){this._log(e,"dir",t)};e.prototype.debug=function(e,t){this._log(e,"debug",t)};e.prototype.error=function(e,t){this._log(e,"error",t)};e.prototype.info=function(e,t){this._log(e,"info",t)};e.prototype.warn=function(e,t){this._log(e,"warn",t)};return e}();o(v,"isAvailable",function(){return typeof console<"u"}());var b=v;var u=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var n={};return e.forEach((function(e){if(m(e))return;var t=__assign(__assign({},n),e);var r;for(r in t)typeof t[r]=="object"&&!Array.isArray(t[r])?n[r]=__assign(__assign({},n[r]),e[r]):n[r]=t[r]})),n};var q=function(){function e(){}e.prototype.create=function(e){return P({context:{timestamp:e.timestamp,server:e.hostname},pageExperience:{pageId:e.url},visitor:{deviceBrowserBreakpoint:e.breakpoint,deviceBrowserHeight:e.height,deviceBrowserOrientation:e.orientation,deviceBrowserWidth:e.width,deviceType:e.deviceType,useragent:e.userAgent}},[void 0])};return e}();var K=w.webProperties,V=function(){return window.location.href.replace(/[?#].*/,"")},Y=function(){return(new Date).toISOString()},Q=function(){return window.location.hostname},R=function(){return window.innerHeight.toString()},D=function(){return window.innerHeight>window.innerWidth?"p":"l"},T=function(){return window.innerWidth.toString()},X=function(){return window.matchMedia("(hover: none), (pointer: coarse)").matches?"mobile":"desktop"},z=function(){return window.navigator.userAgent},J=function(e){if(!e.breakpoints||e.breakpoints.length<1)return;var t=e.breakpoints,n=function(){var e=window.innerWidth;var n=0,r=0;for(;r<t.length&&e>=t[r];)n=t[r],r++;return n.toString()};return e.reactiveDimensions?n:n()},Z=function(e,t){var n=__assign(__assign({},K),e),r={breakpoint:J(n),timestamp:Y(),hostname:Q(),url:n.reactiveUrl?V:V(),height:n.reactiveDimensions?R:R(),orientation:n.reactiveDimensions?D:D(),width:n.reactiveDimensions?T:T(),deviceType:X(),userAgent:z()};return t?t.create(r):r},ee=function(e,t){switch(t){case"string":case"number":case"boolean":return typeof e===t;case"any[]":return Array.isArray(e)&&e.length>0;case"Record<string, any>":return typeof e=="object"&&!Array.isArray(e)&&Object.keys(e).length>0;case"any":return!0;default:if((typeof e=="boolean"||typeof e=="number"||typeof e=="string")&&t.indexOf("|")>0)return t.split("|").map((function(e){var t=e.trim();return/^'.*'$/.test(t)?t.replace(/(^ ?'?|'? ?$)/g,""):/^(true|false)$/.test(t)?t==="true":/^-?(\d*\.)?\d+$/.test(t)?Number.parseFloat(t):t.replace(/(^ ?'?|'? ?$)/g,"")})).includes(e)}return!0},te=function(e,t,n){var r={level:null,issues:[]};if(!n.enabled||!n.eventMatrix)return r;var i=n.eventMatrix,o=i.events,a=__rest(i,["events"]),s=o.indexOf(e);if(s===-1)return r.level="error",r.issues.push({level:"error",type:"EVENT_NOT_FOUND",name:e,message:"'".concat(e,"': Event does not exist.")}),r;var c=C(t),l=Object.keys(a),u=c.filter((function(e){return!l.includes(e)}));u.length>0&&(n.allowUnknown||G(t,u),u.forEach((function(e){var t;r.level=(t=r.level)!==null&&t!==void 0?t:"warn",r.issues.push({level:"warn",type:"PROPERTY_DOES_NOT_EXIST",name:e,message:"'".concat(e,"': Property does not exist in the given Event Matrix.").concat(n.allowUnknown?"":" It was omitted from the DataLayer payload.")})})));var f;for(f in a){var p=a[f],g=typeof p.e[s]<"u",v=p.r===1,d=t?B(t,f):void 0,h=typeof d<"u";if(g&&v&&!h&&(r.level="error",r.issues.push({level:"error",type:"REQUIRED_PROPERTY_MISSING",name:f,message:"'".concat(f,"': The required property is missing.")}),!n.verbose)||h&&!ee(d,p.t)&&(r.level="error",r.issues.push({level:"error",type:"WRONG_PROPERTY_TYPE",name:f,message:"'".concat(f,"': Wrong type detected. Expected '").concat(p.t,"', got '").concat(typeof d,"'.")}),!n.verbose))return r}return r};var ie=function(){function e(e,t,n){if(n===void 0){n="GlobalDataLayer"}o(this,"_className");o(this,"_settings");o(this,"_defaultProperties");o(this,"_logger");o(this,"_webPropertiesHandled",!1);o(this,"_dataLayerStore");o(this,"_extensions",new Map);var r=u(w,e||{});this._className=n,this._logger=new b(this._className,r.logging),this._settings=r,t?this._dataLayerStore=t:typeof window<"u"?(this._dataLayerStore=window.pagData=window.pagData||[],this._logger.info("`dataLayerStore` was set to default `window.pagData`")):(this._dataLayerStore=[],this._logger.info("`dataLayerStore` was set to default `[]`")),this._defaultProperties=[]}e.prototype.setup=function(){this._handleDefaultWebProperties()};Object.defineProperty(e.prototype,"Settings",{get:function(){return this._settings},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"DataLayerStore",{get:function(){return this._dataLayerStore},enumerable:false,configurable:true});e.prototype.getRegisteredExtension=function(e){var t=new e;return this.getRegisteredExtensionByClassName(t.className)};e.prototype.getRegisteredExtensionByClassName=function(e){return this._extensions.has(e)?this._extensions.get(e):void 0};e.prototype.getRegisteredExtensions=function(){var e=[];for(var t=0,n=this._extensions.values();t<n.length;t++){var r=n[t];e.push(r)}return e};e.prototype.registerExtension=function(e,t){if(t===void 0){t=!1}if(!t&&this._extensions.has(e.className)){this._logger.warn("Tried to register extension class <".concat(e.className,"> which already exists."));return}e.dataLayerInstance=this,this._extensions.set(e.className,e),t?this._logger.info("Overriden registration for extension class <".concat(e.className,">.")):this._logger.info("Registered extension class <".concat(e.className,">."))};e.prototype.removeExtension=function(e){var t=new e;if(this._extensions.has(t.className)){this._extensions.delete(t.className);return}this._logger.warn("Tried to remove not existing extension class <".concat(t.className,">."))};e.prototype.removeExtensionByClassName=function(e){if(this._extensions.has(e)){this._extensions.delete(e);return}this._logger.warn("Tried to remove not existing extension class <".concat(e,">."))};e.prototype.push=function(e,t,n){if(t===void 0){t=[{}]}var r,i;if(e.length===0)return!1;var o=n&&!m(n)?u(this._settings,n):this._settings;Array.isArray(t)||(t=[t]),t.forEach(k);var a=this._eventNamePayloadFactory.create({event:e}),s=k(this.getDefaultProperties(e));o.clean.enabled&&o.clean.executionPlace===y.BEFORE_MERGE&&__spreadArray([s||{}],t,true).forEach((function(e){return P(e,o.clean.values)}));var c=u.apply(void 0,__spreadArray([a,s||{}],t,false));if(o.clean.enabled&&o.clean.executionPlace===y.AFTER_MERGE&&P(c,o.clean.values),(r=o==null?void 0:o.validation)!=null&&r.enabled&&((i=o==null?void 0:o.validation)!=null&&i.eventMatrix)){var l=te(e,c,o.validation),f=l.issues.sort((function(e,t){return e.level!==t.level&&t.level==="warn"?-1:0})).map((function(e){return"- [".concat(e.level,"]: ").concat(e.message)})).join("\n");switch(l.level){case"error":return this._logger.error("Validation failed for event '".concat(e,"' with errors/warnings: \n").concat(f),o.logging),!1;case"warn":this._logger.warn("Validation success for event '".concat(e,"' with warnings: \n").concat(f),o.logging);break;default:this._logger.info("Validation success for event '".concat(e,"'."),o.logging);break}}return this._dataLayerStore.push(c),!0};e.prototype.getDefaultProperties=function(e){var t={byName:[],byArray:[],byRegex:[]};this._defaultProperties.forEach((function(n){if(n.identifier===e)return t.byName.push(n.data);if(Array.isArray(n.identifier)&&n.identifier.includes(e))return t.byArray.push(n.data);if(n.identifier instanceof RegExp&&n.identifier.test(e))return t.byRegex.push(n.data)}));var n=__spreadArray(__spreadArray(__spreadArray([],t.byRegex,true),t.byArray,true),t.byName,true);if(n.length)return u.apply(void 0,n)};e.prototype.setDefaultProperties=function(e,t){var n=this._defaultProperties.find((function(t){return t.identifier===e}));if(n){n.data=u(n.data,t);return}this._defaultProperties.push({identifier:e,data:t})};e.prototype._handleDefaultWebProperties=function(){if(this._webPropertiesHandled||!this._settings.webProperties.enabled)return;var e=Z(this._settings.webProperties,this._webPayloadFactory);this.setDefaultProperties(this._settings.webProperties.eventNamePattern,e),this._webPropertiesHandled=!0};return e}();var oe=function(e){__extends(t,e);function t(t,n,r){if(r===void 0){r="GlobalDataLayer"}var i=e.call(this,t,n,r)||this;o(i,"_eventNamePayloadFactory");o(i,"_webPayloadFactory");i._eventNamePayloadFactory=new U,i._webPayloadFactory=new q,i.setup();return i}t.prototype.setup=function(){e.prototype.setup.call(this)};return t}(ie);function getEnvironmentAbbreviation(e){switch(e){case Environments.PRODUCTION:return"P";case Environments.PREVIEW:return"PP";default:return"K"}}var GlobalDataLayerService=function(){function e(){this.homeNavEventId=/^PAGHomeNav_/;this.initialise()}e.prototype.initialise=function(){this.gdl=new oe};e.prototype.pushDataLayerEvent=function(e,t){if(t){this.gdl.push(e,t)}else{this.gdl.push(e)}};e.prototype.setEnvironment=function(e){this.gdl.setDefaultProperties(this.homeNavEventId,{context:{environment:getEnvironmentAbbreviation(e)}})};e.prototype.setPageName=function(e){this.gdl.setDefaultProperties(this.homeNavEventId,{pageExperience:{pageName:e}})};e.prototype.setUser=function(e,t){this.gdl.setDefaultProperties(this.homeNavEventId,{ids:{userId:e},visitor:{loginStatus:t}})};e.prototype.setLocale=function(e){try{var t=splitLocale(e),n=t.country,r=t.language;this.gdl.setDefaultProperties(this.homeNavEventId,{context:{country:n,language:r}})}catch(e){}};e.prototype.setDefaultProperties=function(e,t){var n={context:{applicationId:DATA_LAYER_APP_ID},visitor:{loginStatus:false}};try{var r=splitLocale(e),i=r.country,o=r.language;n=Object.assign(Object.assign({},n),{context:Object.assign(Object.assign({},n.context),{country:i,language:o,applicationName:DATA_LAYER_APPLICATION_NAME})})}catch(e){}if(isString(t)){n=Object.assign(Object.assign({},n),{pageExperience:{pageName:t}})}this.gdl.setDefaultProperties(this.homeNavEventId,n)};return e}();var globalDataLayerService=new GlobalDataLayerService;export{globalDataLayerService as g};
//# sourceMappingURL=global-data-layer-service-04808730.js.map