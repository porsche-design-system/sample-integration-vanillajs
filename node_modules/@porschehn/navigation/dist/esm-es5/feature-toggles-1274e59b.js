var __awaiter=this&&this.__awaiter||function(e,r,t,n){function a(e){return e instanceof t?e:new t((function(r){r(e)}))}return new(t||(t=Promise))((function(t,o){function i(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n["throw"](e))}catch(e){o(e)}}function l(e){e.done?t(e.value):a(e.value).then(i,s)}l((n=n.apply(e,r||[])).next())}))};var __generator=this&&this.__generator||function(e,r){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,a,o,i;return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(r){return l([e,r])}}function l(s){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,s[0]&&(t=0)),t)try{if(n=1,a&&(o=s[0]&2?a["return"]:s[0]?a["throw"]||((o=a["return"])&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;if(a=0,o)s=[s[0]&2,o.value];switch(s[0]){case 0:case 1:o=s;break;case 4:t.label++;return{value:s[1],done:false};case 5:t.label++;a=s[1];s=[0];continue;case 7:s=t.ops.pop();t.trys.pop();continue;default:if(!(o=t.trys,o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){t=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){t.label=s[1];break}if(s[0]===6&&t.label<o[1]){t.label=o[1];o=s;break}if(o&&t.label<o[2]){t.label=o[2];t.ops.push(s);break}if(o[2])t.ops.pop();t.trys.pop();continue}s=r.call(e,t)}catch(e){s=[6,e];a=0}finally{n=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};import{b as Environments,g as getEnvironment}from"./nav-content-store-ad934a75.js";import{V as VERSION,N as NaviError,a as NaviErrorTypes,w as DEFAULT_ENVIRONMENT,i as isString,b as getConfig}from"./navi-error-d2e07707.js";import{w as windowService}from"./window-service-890948e7.js";var FEATURE_OVERRIDE_ENABLED="featureOverrideEnabled";var FEATURE_PORSCHE_75_YEARS_LOGO="porsche_75_years_logo";var FEATURE_SHOP="shop";var FEATURE_PCOM_SEARCH="pcom_search";var FEATURE_SAVED_ITEMS="saved_items";var FEATURE_AB_TESTING="ab";var FEATURE_DEALER_SEARCH_CHINA="dealer_search_china";var FEATURE_DEALER_SEARCH_OPENING_HOURS="opening_hours";var local={featureOverrideEnabled:{enabled:true},homenav_1723:{enabled:true},navi_3:{enabled:false},porsche_75_years_logo:{enabled:false},one_ui:{enabled:false},mock_shop_content:{enabled:false},shop:{enabled:false},pcom_search:{enabled:false}};var preview={featureOverrideEnabled:{enabled:true},homenav_1723:{enabled:true},navi_3:{enabled:false},porsche_75_years_logo:{enabled:false},one_ui:{enabled:false},mock_shop_content:{enabled:false},shop:{enabled:false},pcom_search:{enabled:false}};var test={featureOverrideEnabled:{enabled:true},homenav_1723:{enabled:true},navi_3:{enabled:true},porsche_75_years_logo:{enabled:false},one_ui:{enabled:false},mock_shop_content:{enabled:false},shop:{enabled:false},pcom_search:{enabled:false}};var production={featureOverrideEnabled:{enabled:false},homenav_1723:{enabled:false},navi_3:{enabled:true},porsche_75_years_logo:{enabled:false},mock_shop_content:{enabled:false},shop:{enabled:false},pcom_search:{enabled:false}};var featureJson={local:local,preview:preview,test:test,production:production};var LOGGING_ENDPOINT="https://logs.nav.porsche.com";var Logger=function(){function e(){this.env=null;this.version=VERSION;this.breakpoint=0;this.locale=null}e.prototype.init=function(e,r,t){this.env=e;this.breakpoint=r;this.locale=t};e.prototype.log=function(e,r,t,n,a){if(this.env===Environments.TEST){return}try{var o=JSON.stringify({name:e,level:r,env:this.env,breakpoint:this.breakpoint,locale:this.locale,version:this.version,hostname:windowService.location.hostname,pathname:windowService.location.pathname,id:t,errorType:a||"",message:n});if(this.env===Environments.PRODUCTION){if(r!=="debug"){fetch(LOGGING_ENDPOINT,{method:"POST",body:o,mode:"no-cors"})}}else{console[r](o)}}catch(e){}};e.prototype.info=function(e,r){if(r===void 0){r=""}this.log("PHN_HEADER_LOG_ENTRY","info",e,r)};e.prototype.error=function(e,r){var t=r instanceof NaviError?r.type:NaviErrorTypes.GENERAL;this.log("PHN_HEADER_LOG_ENTRY","error",e,r.message,t)};return e}();var logger=new Logger;var FeatureToggles=function(){function e(e,r){if(e===void 0){e=getEnvironment(DEFAULT_ENVIRONMENT)}if(r===void 0){r=featureJson}var t=this;this.featureEnvMap=r;this.features={};this.env="local";this.isShopToggleActive=function(){return t.isFeatureEnabled(FEATURE_SHOP,windowService.location.search)};this.isPcomSearchToggleActive=function(){return t.isFeatureEnabled(FEATURE_PCOM_SEARCH,windowService.location.search)};this.isSavedItemsToggleActive=function(){return t.isFeatureEnabled(FEATURE_SAVED_ITEMS,windowService.location.search)};this.isABTestingToggleActive=function(){return t.isFeatureEnabled(FEATURE_AB_TESTING,windowService.location.search)};this.isDealerSearchChinaEnabled=function(){return t.isFeatureEnabled(FEATURE_DEALER_SEARCH_CHINA,windowService.location.search)};this.isDealerSearchOpeningHoursEnabled=function(){return t.isFeatureEnabled(FEATURE_DEALER_SEARCH_OPENING_HOURS,windowService.location.search)};this.env=e;this.features=this.featureEnvMap[e]}e.prototype.loadRemoteToggles=function(){return __awaiter(this,void 0,void 0,(function(){var e,r,t,n,a;return __generator(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,,6]);e=getConfig(this.env).BFF_ENDPOINT;return[4,fetch("".concat(e,"/toggles?env=").concat(this.env))];case 1:r=o.sent();if(!!r.ok)return[3,3];return[4,r.text()];case 2:t=o.sent();throw new Error(t);case 3:return[4,r.json()];case 4:n=o.sent();this.features=n;return[3,6];case 5:a=o.sent();throw new NaviError("Load Feature Toggles failed with error: ".concat(a),NaviErrorTypes.GENERAL);case 6:return[2]}}))}))};e.prototype.stringToBooleanStrict=function(e){if(e==="true"){return true}if(e==="false"){return false}return null};e.prototype.getUrlFeatureToggleOverride=function(e,r){var t,n;var a=(n=(t=r.split("?")[1])===null||t===void 0?void 0:t.split("&").find((function(r){return r.includes(e)})))===null||n===void 0?void 0:n.split("=")[1];return isString(a)?this.stringToBooleanStrict(a||""):null};e.prototype.getLocalStorageFeatureToggleOverride=function(e){var r=localStorage.getItem("phn.".concat(e));return isString(r)?this.stringToBooleanStrict(r):null};e.prototype.isFeatureEnabled=function(e,r){var t;if(this.features===undefined){return false}if(this.env===Environments.PRODUCTION&&this.isOnSecurityLayer(e)){return false}if((t=this.features[FEATURE_OVERRIDE_ENABLED])===null||t===void 0?void 0:t.enabled){var n=[this.getUrlFeatureToggleOverride(e,r),this.getLocalStorageFeatureToggleOverride(e)];for(var a=0,o=n;a<o.length;a++){var i=o[a];if(i!==null){return i}}}if(this.features[e]!==undefined){return this.features[e].enabled}else{return false}};e.prototype.setFeatures=function(e){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(t){switch(t.label){case 0:this.env=e;t.label=1;case 1:t.trys.push([1,3,,4]);if(e==="test"){this.features=this.featureEnvMap[e];return[2]}return[4,this.loadRemoteToggles()];case 2:t.sent();return[3,4];case 3:r=t.sent();logger.error("INIT_APP_CONFIG",r);this.features=this.featureEnvMap[e];return[3,4];case 4:return[2]}}))}))};e.prototype.isOnSecurityLayer=function(e){var r=["opening_hours"];return r.includes(e)};return e}();var featureToggles=new FeatureToggles;export{FEATURE_PORSCHE_75_YEARS_LOGO as F,featureToggles as f,logger as l};
//# sourceMappingURL=feature-toggles-1274e59b.js.map