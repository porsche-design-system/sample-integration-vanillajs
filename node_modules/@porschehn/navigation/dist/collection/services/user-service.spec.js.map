{"version":3,"file":"user-service.spec.js","sourceRoot":"","sources":["../../../src/services/user-service.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import { firstUserProfileData } from '../test/test-data';\nimport * as userService from './user-service';\nimport windowService from './window-service';\nimport { NaviError, NaviErrorTypes } from '../utility/navi-error';\nimport { navStateStore } from '../state/nav-state-store';\nimport {\n  DEFAULT_UNREAD_MESSAGES_COUNT,\n  LOGGED_IN_USER_NO_NAME_STATUS,\n  LOGGED_OUT_USER_STATUS\n} from '../utility/constants';\nimport { Config } from '../entities/config';\n\nconst { getUserIdFromUserData, getUserNameFromUserData, initializeUserData } = userService;\n\ndescribe('User Service', () => {\n  describe('getUserNameFromUserData', () => {\n    it('should return hashed email address as userId', async () => {\n      const crypto = jest.spyOn(windowService, 'hashString').mockImplementation(async () => '');\n      await getUserIdFromUserData({ ...firstUserProfileData });\n      expect(crypto).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe('getUserNameFromUserData', () => {\n    it('should return default value if no name parameters are present in userData', async () => {\n      const userDataNoName = {\n        ...firstUserProfileData,\n        firstName: undefined,\n        lastName: undefined\n      };\n      expect(getUserNameFromUserData(userDataNoName)).toBe('');\n    });\n\n    it('should return name if only firstName parameters are present in userData', async () => {\n      const userDataNoName = { ...firstUserProfileData, lastName: undefined };\n      expect(getUserNameFromUserData(userDataNoName)).toBe('Mirinda');\n    });\n\n    it('should return name if only firstName and lastName parameters are present in userData', async () => {\n      const userDataNoName = { ...firstUserProfileData };\n      expect(getUserNameFromUserData(userDataNoName)).toBe('Mirinda Doe');\n    });\n\n    it('should return last name if only lastName parameter is present in userData', async () => {\n      const userDataNoName = { ...firstUserProfileData, firstName: undefined };\n      expect(getUserNameFromUserData(userDataNoName)).toBe('Doe');\n    });\n\n    it('should return first name if only firstName parameter is present in userData', async () => {\n      const userDataNoName = { ...firstUserProfileData, lastName: undefined };\n      expect(getUserNameFromUserData(userDataNoName)).toBe('Mirinda');\n    });\n\n    it('should return name if all name parameters are present in userData', async () => {\n      expect(getUserNameFromUserData(firstUserProfileData)).toBe('Mirinda Doe');\n    });\n\n    it('should return empty string empty profile passed', async () => {\n      expect(getUserNameFromUserData({})).toBe('');\n    });\n  });\n\n  describe('initialize user data', () => {\n    const accessToken = 'fake-access-token';\n    const locale = 'en-US';\n    const config = { API_URL: 'http://fake-api-url.com' };\n\n    const throwOnMockedFetch = (reason: string) => {\n      jest.spyOn(global, 'fetch').mockImplementationOnce(() => {\n        throw new Error(reason);\n      });\n    };\n\n    it('should throw general error', async () => {\n      const errorReason = 'Error fetching user';\n      const expectedError = new NaviError(\n        `Exception occurred while fetching user info: \"${errorReason}\"`,\n        NaviErrorTypes.GENERAL\n      );\n\n      throwOnMockedFetch(errorReason);\n\n      try {\n        await initializeUserData(accessToken, locale, config as unknown as Config);\n      } catch (err) {\n        expect(navStateStore.state.unreadMessagesCount).toEqual(DEFAULT_UNREAD_MESSAGES_COUNT);\n        expect(navStateStore.state.loggedInState).toEqual(LOGGED_IN_USER_NO_NAME_STATUS);\n        expect(err).toEqual(expectedError);\n      }\n    });\n\n    it('should throw unauthorized user', async () => {\n      const error = new NaviError(`AccessToken has expired`, NaviErrorTypes.UNAUTHORIZED);\n\n      jest.spyOn(global, 'fetch').mockResolvedValueOnce({\n        status: 401\n      } as Response);\n\n      try {\n        await initializeUserData(accessToken, locale, config as unknown as Config);\n      } catch (err) {\n        expect(navStateStore.state.unreadMessagesCount).toEqual(DEFAULT_UNREAD_MESSAGES_COUNT);\n        expect(navStateStore.state.loggedInState).toEqual(LOGGED_OUT_USER_STATUS);\n        expect(err).toEqual(error);\n      }\n    });\n\n    it('should throw general error if response is not Ok', async () => {\n      const error = new NaviError('Error occurred: 200 Some error occurred', NaviErrorTypes.GENERAL);\n\n      jest.spyOn(global, 'fetch').mockResolvedValueOnce({\n        ok: false,\n        status: 200,\n        statusText: 'Some error occurred'\n      } as Response);\n\n      try {\n        await initializeUserData(accessToken, locale, config as unknown as Config);\n      } catch (err) {\n        expect(navStateStore.state.unreadMessagesCount).toEqual(DEFAULT_UNREAD_MESSAGES_COUNT);\n        expect(navStateStore.state.loggedInState).toEqual(LOGGED_IN_USER_NO_NAME_STATUS);\n        expect(err).toEqual(error);\n      }\n    });\n\n    it('should throw error if user is null', async () => {\n      const error = new NaviError(\n        'Invalid user data object extracted from user profile response',\n        NaviErrorTypes.NO_RESULTS\n      );\n\n      jest.spyOn(global, 'fetch').mockResolvedValueOnce({\n        ok: true,\n        status: 200,\n        json: async () => null\n      } as Response);\n\n      try {\n        await initializeUserData(accessToken, locale, config as unknown as Config);\n      } catch (err) {\n        expect(navStateStore.state.unreadMessagesCount).toEqual(DEFAULT_UNREAD_MESSAGES_COUNT);\n        expect(navStateStore.state.loggedInState).toEqual(LOGGED_IN_USER_NO_NAME_STATUS);\n        expect(err).toEqual(error);\n      }\n    });\n\n    it('should throw error if results returns a malformed json', async () => {\n      const error = new NaviError(\n        'Could not extract json from user profile response: Error on user profile response',\n        NaviErrorTypes.GENERAL\n      );\n\n      jest.spyOn(global, 'fetch').mockResolvedValueOnce({\n        ok: true,\n        status: 200,\n        json: async () => Promise.reject('Error on user profile response')\n      } as unknown as Response);\n\n      try {\n        await initializeUserData(accessToken, locale, config as unknown as Config);\n      } catch (err) {\n        expect(navStateStore.state.unreadMessagesCount).toEqual(DEFAULT_UNREAD_MESSAGES_COUNT);\n        expect(navStateStore.state.loggedInState).toEqual(LOGGED_IN_USER_NO_NAME_STATUS);\n        expect(err).toEqual(error);\n      }\n    });\n  });\n});\n"]}