{"version":3,"file":"global-data-layer-service.js","sourceRoot":"","sources":["../../../../src/services/analytics/global-data-layer-service.ts"],"names":[],"mappings":"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","sourcesContent":["import { GlobalDataLayer } from '@porsche/globaldatalayer';\nimport { TContextEnvironment, TDataLayer } from '@porsche/globaldatalayer-events/projects/pcom/all/types';\nimport { Environment, Environments } from '../../entities/environment';\nimport { splitLocale } from '../../entities/locale';\nimport { DATA_LAYER_APPLICATION_NAME, DATA_LAYER_APP_ID, EventAction } from '../../utility/constants';\nimport { isString } from '../../utility/helper';\n\nfunction getEnvironmentAbbreviation(env: Environment): TContextEnvironment {\n  switch (env) {\n    case Environments.PRODUCTION:\n      return 'P';\n    case Environments.PREVIEW:\n      return 'PP';\n    default:\n      return 'K';\n  }\n}\n\nclass GlobalDataLayerService {\n  homeNavEventId = /^PAGHomeNav_/;\n  gdl!: GlobalDataLayer<TDataLayer>;\n\n  constructor() {\n    this.initialise();\n  }\n\n  initialise() {\n    this.gdl = new GlobalDataLayer();\n  }\n\n  pushDataLayerEvent(eventAction: EventAction, eventData?: TDataLayer): void {\n    if (eventData) {\n      this.gdl.push(eventAction, eventData);\n    } else {\n      this.gdl.push(eventAction);\n    }\n  }\n\n  setEnvironment(env: Environment) {\n    this.gdl.setDefaultProperties(this.homeNavEventId, {\n      context: { environment: getEnvironmentAbbreviation(env) }\n    });\n  }\n\n  setPageName(pageName?: string) {\n    this.gdl.setDefaultProperties(this.homeNavEventId, {\n      pageExperience: {\n        pageName: pageName\n      }\n    });\n  }\n\n  setUser(userId: string, loginStatus: boolean) {\n    this.gdl.setDefaultProperties(this.homeNavEventId, {\n      ids: { userId },\n      visitor: { loginStatus }\n    });\n  }\n\n  setLocale(locale: string) {\n    try {\n      const { country, language } = splitLocale(locale);\n\n      this.gdl.setDefaultProperties(this.homeNavEventId, {\n        context: { country: country, language: language }\n      });\n    } catch (err) {\n      // throw the error away\n    }\n  }\n\n  setDefaultProperties(locale: string, pageName?: string): void {\n    let defaultGDLProperties: TDataLayer = {\n      context: { applicationId: DATA_LAYER_APP_ID },\n      visitor: { loginStatus: false }\n    };\n\n    try {\n      const { country, language } = splitLocale(locale);\n\n      defaultGDLProperties = {\n        ...defaultGDLProperties,\n        context: { ...defaultGDLProperties.context, country, language, applicationName: DATA_LAYER_APPLICATION_NAME }\n      };\n    } catch (err) {\n      // throw the error away\n    }\n\n    if (isString(pageName)) {\n      defaultGDLProperties = { ...defaultGDLProperties, pageExperience: { pageName: pageName } };\n    }\n\n    this.gdl.setDefaultProperties(this.homeNavEventId, defaultGDLProperties);\n  }\n}\n\nexport default new GlobalDataLayerService();\n"]}