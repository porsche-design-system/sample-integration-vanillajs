{"version":3,"file":"car-body-types-drawer.js","sourceRoot":"","sources":["../../../../src/components/car-body-types-drawer/car-body-types-drawer.tsx"],"names":[],"mappings":"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","sourcesContent":["import { breakpoint } from '@porsche-design-system/components-js/styles';\nimport { Component, Element, Fragment, getAssetPath, h, Host, Prop, State, Watch } from '@stencil/core';\nimport { BodyType, Series, TLink } from '../../entities/content';\nimport globalDataLayerService from '../../services/analytics/global-data-layer-service';\nimport { navStateStore } from '../../state/nav-state-store';\nimport { ClickElementTypes, ElementTypes, EventActions } from '../../utility/constants';\nimport { getConfig, getHTMLElement, isString } from '../../utility/helper';\nimport { componentsOnReady } from '../../utility/ready';\nimport { Timeout } from '../../utility/timeout';\nimport analyticsManager from '../../services/analytics/analytics-manager';\n\n@Component({\n  tag: 'phn-car-body-types-drawer',\n  styleUrl: 'car-body-types-drawer.scss',\n  assetsDirs: ['model-assets'],\n  scoped: true\n})\nexport class CarBodyTypeDrawer {\n  @Prop() series!: Series;\n  @Prop() breakpoint!: number;\n  @Prop() activeRoutingKey!: string;\n\n  @State() seriesLoaded = false;\n  @State() showSkeleton = true;\n\n  @Element() el!: HTMLPhnCarBodyTypesDrawerElement;\n\n  @Watch('series')\n  seriesWatcher(): void {\n    this.seriesLoaded = false;\n    this.showSkeleton = true;\n  }\n\n  private bodyTypesImagesLoaded = new Set<string>();\n  private bodyTypesImagesNotLoaded = new Set<string>();\n\n  private async waitForComponentsToLoad() {\n    await componentsOnReady(this.el, new Timeout(5000));\n    this.showSkeleton = !this.seriesLoaded;\n  }\n\n  componentWillLoad(): void {\n    this.waitForComponentsToLoad();\n  }\n\n  componentDidRender(): void {\n    this.showSkeleton = !this.seriesLoaded;\n  }\n\n  private handleImageLoad(seriesId: string) {\n    this.bodyTypesImagesLoaded.add(seriesId);\n\n    if (this.series.bodyTypes.every(({ id }) => this.bodyTypesImagesLoaded.has(id))) {\n      this.seriesLoaded = true;\n    }\n  }\n\n  private handleImageLoadError(seriesId: string) {\n    this.handleImageLoad(seriesId);\n    this.bodyTypesImagesNotLoaded.add(seriesId);\n  }\n\n  private sendMetaFunctionDataLayerEvent(link: TLink): void {\n    globalDataLayerService.pushDataLayerEvent(EventActions.MODEL_CTA_CLICK, {\n      componentClick: {\n        clickElementId: link.id,\n        clickElementName: link.text,\n        clickElementType: ClickElementTypes.Link,\n        targetUrl: link.link\n      },\n      componentDisplay: {\n        displayElementId: analyticsManager.calculateDisplayElementId(),\n        displayElementType: analyticsManager.calculateDisplayElementType(\n          this.activeRoutingKey,\n          ElementTypes.bodyTypeButton\n        ),\n        displayElementName: link.text\n      },\n      car: {\n        modelRangeName: link.id.split('.')[1]\n      }\n    });\n  }\n\n  private sendBodyTypeClickDataLayerEvent(bodyType: BodyType, tagName: string): void {\n    globalDataLayerService.pushDataLayerEvent(EventActions.MODEL_CLICK, {\n      componentClick: {\n        clickElementId: bodyType.id,\n        clickElementName: bodyType.name,\n        clickElementType: tagName === 'IMG' ? ClickElementTypes.Image : ClickElementTypes.Link,\n        targetUrl: bodyType.link\n      },\n      componentDisplay: {\n        displayElementId: analyticsManager.calculateDisplayElementId(),\n        displayElementType: analyticsManager.calculateDisplayElementType(\n          this.activeRoutingKey,\n          ElementTypes.bodyTypeButton\n        ),\n        displayElementName: bodyType.name\n      },\n      car: {\n        modelRangeName: bodyType.id.split('.')[1],\n        modelName: analyticsManager.getModelName(bodyType)\n      }\n    });\n  }\n\n  private sendNavigationDataLayerEvent(): void {\n    globalDataLayerService.pushDataLayerEvent(EventActions.MODEL_CLICK, {\n      componentClick: {\n        clickElementId: this.series.all.id,\n        clickElementName: this.series.all.text,\n        clickElementType: ClickElementTypes.Link,\n        targetUrl: this.series.all.link\n      },\n      componentDisplay: {\n        displayElementId: analyticsManager.calculateDisplayElementId(),\n        displayElementType: analyticsManager.calculateDisplayElementType(\n          this.activeRoutingKey,\n          ElementTypes.bodyTypeButton\n        ),\n        displayElementName: this.series.all.text\n      }\n    });\n  }\n\n  private getImageSize(currentBreakpoint: number): number {\n    switch (currentBreakpoint) {\n      case breakpoint.xxl:\n        return 1920;\n      case breakpoint.xl:\n      case breakpoint.l:\n        return 1360;\n      case breakpoint.m:\n        return 1024;\n      case breakpoint.s:\n        return 760;\n      case breakpoint.xs:\n      case breakpoint.base:\n      default:\n        return 320;\n    }\n  }\n\n  private getImageSource(image: string): string {\n    const assetPath = getAssetPath(`${getConfig(navStateStore.state.env).ASSETS_URL}/model-assets`);\n    const imageSize = this.getImageSize(this.breakpoint);\n    const imagePath = `${assetPath}/${imageSize}`;\n\n    return `${imagePath}/${image}.webp, ${imagePath}/${image}@2x.webp 2x`;\n  }\n\n  render(): HTMLPhnCarBodyTypesDrawerElement {\n    return (\n      <Host class={`${this.showSkeleton ? 'skeleton' : ''}`}>\n        <Fragment>\n          <ul class=\"links\">\n            {this.series.links.map((link) => (\n              <Fragment>\n                {this.showSkeleton ? <div class=\"skeleton-link\" /> : null}\n                <phn-p-link\n                  key={link.id}\n                  variant=\"tertiary\"\n                  href={link.link}\n                  icon={link.icon}\n                  size=\"inherit\"\n                  class=\"link\"\n                  style={{ display: this.showSkeleton ? 'none' : '' }}\n                  onClick={() => {\n                    this.sendMetaFunctionDataLayerEvent(link);\n                  }}\n                  role=\"listitem\"\n                >\n                  {link.text}\n                </phn-p-link>\n              </Fragment>\n            ))}\n          </ul>\n          <ul>\n            {this.series.bodyTypes.map((bodyType) => {\n              return (\n                <Fragment>\n                  {this.showSkeleton ? (\n                    <Fragment>\n                      <div class=\"skeleton-image\" />\n                    </Fragment>\n                  ) : null}\n                  <div\n                    class=\"series-body-type\"\n                    key={bodyType.id}\n                    style={{ display: this.showSkeleton ? 'none' : '' }}\n                    role=\"listitem\"\n                  >\n                    <phn-p-link-pure\n                      icon=\"none\"\n                      onClick={(e: MouseEvent) => {\n                        const clickedElement = getHTMLElement(e.target);\n                        if (clickedElement !== null) {\n                          this.sendBodyTypeClickDataLayerEvent(bodyType, clickedElement.tagName);\n                        }\n                      }}\n                    >\n                      <a href={bodyType.link}>\n                        {this.bodyTypesImagesNotLoaded.has(bodyType.id) ? (\n                          <Fragment>\n                            <div class=\"skeleton-bodytype\" />\n                          </Fragment>\n                        ) : (\n                          <div class=\"model-link-content\">\n                            <img\n                              srcSet={this.getImageSource(bodyType.image)}\n                              alt={`${bodyType.name} Sideshot`}\n                              onLoad={() => this.handleImageLoad(bodyType.id)}\n                              onError={() => this.handleImageLoadError(bodyType.id)}\n                            />\n\n                            <phn-p-text size=\"inherit\" color=\"inherit\" align=\"center\">\n                              {bodyType.name}\n                            </phn-p-text>\n\n                            {isString(bodyType.description) ? (\n                              <phn-p-text className=\"model-description\" size=\"x-small\" align=\"center\">\n                                {bodyType.description}\n                              </phn-p-text>\n                            ) : null}\n                          </div>\n                        )}\n                      </a>\n                    </phn-p-link-pure>\n                  </div>\n                </Fragment>\n              );\n            })}\n          </ul>\n          {this.showSkeleton ? null : (\n            <phn-p-link\n              variant=\"tertiary\"\n              href={this.series.all.link}\n              size=\"inherit\"\n              class=\"further\"\n              data-test-id=\"car-body-types-drawer-further-links-button\"\n              onClick={() => {\n                this.sendNavigationDataLayerEvent();\n              }}\n            >\n              {this.series.all.text}\n            </phn-p-link>\n          )}\n        </Fragment>\n      </Host>\n    );\n  }\n}\n"]}