{"version":3,"file":"autocomplete-search-field.js","sourceRoot":"","sources":["../../../../src/components/autocomplete-search-field/autocomplete-search-field.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, EventEmitter, h, Prop, State, Event, getAssetPath, Element, Listen, Watch } from '@stencil/core';\nimport { Prediction } from '../../entities/places';\nimport { navStateStore } from '../../state/nav-state-store';\nimport { getConfig, getHTMLInputElement, isString } from '../../utility/helper';\nimport { dealerSearchResultsStore } from '../../state/dealer-search-results-store';\n\n@Component({\n  tag: 'phn-autocomplete-search-field',\n  styleUrl: 'autocomplete-search-field.scss',\n  scoped: true\n})\nexport class AutocompleteSearchField {\n  @Prop() placeholder!: string;\n  @Prop() predictions!: Prediction[];\n  @Prop() initialValue = '';\n  @Prop() errorState = '';\n  @Prop() errorMessage = '';\n\n  @State() showPredictions = false;\n  @State() highlightedPredictionIndex = -1;\n  @State() searchterm = this.initialValue;\n\n  @Event() searchInput!: EventEmitter<string>;\n  @Event() clearSearch!: EventEmitter<void>;\n  @Event() submitSearch!: EventEmitter<Prediction | null>;\n  @Event() predictionsToggle!: EventEmitter<boolean>;\n  @Event() autoCompleteLoaded!: EventEmitter<boolean>;\n\n  @Element() el!: HTMLPhnAutocompleteSearchFieldElement;\n\n  @Listen('click', { passive: true, target: 'window' })\n  clickListener(e: MouseEvent): void {\n    this.showPredictions =\n      e.composedPath()[0] === this.el.querySelector('input.autofocus') && this.predictions.length > 0;\n  }\n\n  @Listen('keydown', { passive: false })\n  keydownListener(e: KeyboardEvent): void {\n    if (e.key === 'Escape' && this.showPredictions) {\n      e.preventDefault();\n      e.stopPropagation();\n      this.showPredictions = false;\n    }\n  }\n\n  @Watch('showPredictions')\n  watchShowPredictions(newValue: boolean): void {\n    this.predictionsToggle.emit(newValue);\n  }\n\n  @Watch('initialValue')\n  watchInitialValue(): void {\n    this.searchterm = this.initialValue;\n  }\n\n  componentDidRender(): void {\n    this.autoCompleteLoaded.emit(true);\n  }\n\n  private onKeyDown(pressedKey: string): void {\n    if (this.predictions.length === 0) return;\n\n    switch (pressedKey) {\n      case 'ArrowDown':\n        if (!this.showPredictions) {\n          return;\n        }\n        if (this.highlightedPredictionIndex === this.predictions.length - 1) {\n          this.highlightedPredictionIndex = 0;\n          break;\n        }\n        this.highlightedPredictionIndex++;\n        break;\n\n      case 'ArrowUp':\n        if (!this.showPredictions) {\n          return;\n        }\n        if (this.highlightedPredictionIndex < 0) {\n          this.highlightedPredictionIndex = 0;\n          break;\n        } else if (this.highlightedPredictionIndex === 0) {\n          this.highlightedPredictionIndex = this.predictions.length - 1;\n          break;\n        }\n        this.highlightedPredictionIndex--;\n        break;\n    }\n\n    if (this.highlightedPredictionIndex > -1) {\n      this.searchterm = this.predictions[this.highlightedPredictionIndex].text;\n    }\n  }\n\n  private onSubmit() {\n    const prediction =\n      this.highlightedPredictionIndex < 0 ? this.predictions[0] : this.predictions[this.highlightedPredictionIndex];\n    this.submitSearch.emit(prediction ?? null);\n    this.showPredictions = false;\n    if (prediction !== undefined) this.searchterm = prediction.text;\n  }\n\n  render(): HTMLPhnAutocompleteSearchFieldElement {\n    return (\n      <form\n        class=\"form-container\"\n        onSubmit={(event) => {\n          event.preventDefault();\n          this.onSubmit();\n        }}\n      >\n        <phn-p-text-field-wrapper\n          data-test-id=\"dealer-search-form-input\"\n          state={isString(this.errorMessage) ? 'error' : 'none'}\n          message={this.errorMessage}\n        >\n          <input\n            class=\"autofocus\"\n            aria-label=\"Find a dealer by typing a city name or zip code\"\n            type=\"search\"\n            placeholder={this.placeholder}\n            autocomplete=\"off\"\n            role=\"combobox\"\n            data-validate=\"required\"\n            aria-expanded={(this.predictions.length > 0 && this.showPredictions).toString()}\n            aria-controls=\"predictions\"\n            aria-autocomplete=\"list\"\n            aria-activedescendant={this.showPredictions ? String(this.highlightedPredictionIndex) : undefined}\n            value={this.searchterm}\n            onInput={(event: Event) => {\n              event.preventDefault();\n\n              this.showPredictions = true;\n              this.highlightedPredictionIndex = -1;\n\n              const value = getHTMLInputElement(event.target)?.value;\n\n              if (!isString(value)) {\n                this.searchterm = '';\n                this.showPredictions = false;\n                dealerSearchResultsStore.state.savedDealerCookie = null;\n                this.clearSearch.emit();\n                return;\n              }\n\n              this.searchInput.emit(value);\n            }}\n            onKeyDown={(event: KeyboardEvent) => {\n              this.onKeyDown(event.key);\n            }}\n          />\n        </phn-p-text-field-wrapper>\n\n        {this.predictions.length > 0 && this.showPredictions ? (\n          <div class=\"prediction-container\">\n            <ul\n              id=\"predictions\"\n              data-test-id=\"dealer-search-autocomplete-predictions\"\n              role=\"listbox\"\n              aria-label=\"List of location predictions\"\n            >\n              {this.predictions.map((prediction, index) => (\n                <li\n                  key={prediction.id}\n                  class={index === this.highlightedPredictionIndex ? 'highlighted-prediction' : ''}\n                  role=\"option\"\n                  aria-selected={String(index === this.highlightedPredictionIndex)}\n                  id={String(index)}\n                  onClick={() => {\n                    this.highlightedPredictionIndex = index;\n                    this.onSubmit();\n                  }}\n                  onKeyDown={(event: KeyboardEvent) => {\n                    // TODO: does this code ever get executed?\n                    if (event.key === 'Enter') {\n                      this.onSubmit();\n                    }\n                  }}\n                >\n                  <phn-p-text color=\"inherit\">{prediction.text}</phn-p-text>\n                </li>\n              ))}\n            </ul>\n            <img\n              class=\"powered-by-google\"\n              src={getAssetPath(\n                `${getConfig(navStateStore.state.env).ASSETS_URL}/icon-assets/powered_by_google_on_white.png`\n              )}\n              alt=\"powered by Google\"\n            />\n          </div>\n        ) : null}\n      </form>\n    );\n  }\n}\n"]}