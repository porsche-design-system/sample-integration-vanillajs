import{d as t,a as e,n}from"./p-b43baa04.js";import{w as o}from"./p-f167c919.js";import{S as s,N as i,a as r,u as a}from"./p-f7be0ef8.js";import{f as c,l as u}from"./p-19268c27.js";const m=t({searchTerm:"",results:null,savedDealerCookie:p(),ppnDealers:{},dealersOfRegion:{regions:[]}});m.onChange("savedDealerCookie",(t=>{o.setCookie(s,JSON.stringify(t))}));function p(){try{return JSON.parse(o.getCookie(s))}catch(t){return null}}const h={};class l{constructor(){this.client=null;this.experiments=[]}async init(){if(c.isABTestingToggleActive()){try{await this.setClient();await this.loadExperiments()}catch(t){u.error("Could not initialize AbTesting",t)}}}execute(t){if(c.isABTestingToggleActive()){try{const e=this.getExperiment(t);const n=this.getVariation(e);n.activate()}catch(e){u.error(`Could not execute experiment ${t}`,e)}}}executeContentChange(t){if(c.isABTestingToggleActive()){try{const e=this.getExperiment(t.experienceName);const n=this.getVariation(e);if(n.name==="original"){return t.children}return n.activate()}catch(e){u.error(`Could not execute experiment ${t.experienceName}`,e)}}return t.children}async setClient(){if(this.client)return Promise.resolve(this.client);await this.injectScript();const t=window;this.client=t.Matomo;return this.client}async loadExperiments(){const t=this.getClient();const e=t.AbTesting.Experiment;const n=this.getAbTestingDefinitions();for(const t in n){const o=n[t];const s=new e(o);this.experiments.push(s)}}async loadContentGeneratorExperiments(){if(c.isABTestingToggleActive()){const t=this.getClient();const n=t.AbTesting.Experiment;const o=e.state.abExperiences;if(o){for(const t of o){const e=t.variations.map((t=>({name:t.name,activate:()=>t.children})));e.push({name:"original",activate:()=>null});const o=new n(Object.assign(Object.assign({},t),{variations:e}));this.experiments.push(o)}}}}getExperiment(t){const e=this.experiments.find((e=>e.name===t));if(!e)throw new i(`No experiment with name: ${t} found`,r.GENERAL);return e}getVariation(t){const e=t.getActivatedVariationName();const n=t.variations.find((t=>t.name===e));if(!n)throw new i(`No variation in experiment: ${t.name} with name: ${e} found`,r.GENERAL);return n}getClient(){if(!this.client)throw new i("No client is set, you must call init first",r.GENERAL);return this.client}injectScript(){return new Promise(((t,e)=>{const n=document.createElement("script");n.text=this.getMatomoScript();document.head.appendChild(n);const o=a(document.querySelector('script[src="//cdn.matomo.cloud/porsche.matomo.cloud/matomo.js"]'));if(o){o.onload=()=>{t(true)};o.onerror=()=>e(new i("Could not inject Matomo script",r.GENERAL))}else{e(new i("There is no HTML Script element available",r.GENERAL))}}))}getAbTestingDefinitions(){return h}getMatomoScript(){const t=n.state.env;return`var _paq = window._paq = window._paq || [];\n    _paq.push(['trackPageView']);\n    _paq.push(['enableLinkTracking']);\n    (function() {\n      var u="https://porsche.matomo.cloud/";\n      _paq.push(['setTrackerUrl', u+'matomo.php']);\n      _paq.push(['setSiteId', ${t==="production"?"7":"8"}]);\n      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];\n      g.async=true; g.src='//cdn.matomo.cloud/porsche.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);\n    })\n   ();`}}const d=new l;function f(){return d}export{f as a,m as d};
//# sourceMappingURL=p-c45b4ca8.js.map