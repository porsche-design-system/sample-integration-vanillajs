import{s as e,D as t,c as r,d as s}from"./p-ce02e561.js";import{i as n}from"./p-e1568a59.js";var i=Object.defineProperty;var o=(e,t,r)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var a=(e,t,r)=>(o(e,typeof t!="symbol"?t+"":t,r),r);const c={BEFORE_MERGE:"BEFORE_MERGE",AFTER_MERGE:"AFTER_MERGE"},l={clean:{enabled:!1,executionPlace:c.AFTER_MERGE,values:["",void 0,null]},logging:{enabled:!0,level:"warn"},validation:{enabled:!1,allowUnknown:!1,verbose:!0},webProperties:{enabled:!0,eventNamePattern:/.*/,reactiveUrl:!0,reactiveDimensions:!0}};class u{create(e){return typeof e.event!="string"||e.event.length===0?{}:{context:{eventAction:e.event}}}}const h=(e,t)=>{let r;for(r in e)if(!(!e||!e[r])&&t(e[r],r)===!1)return!1;return!0},d=(e,t)=>h(e,((r,s)=>{for(const n in e[s])if(t(r[n],n,r,s)===!1)return!1;return!0})),f=e=>{for(const t in e)return!1;return!0},g=(e,t=(e=>(e=l.clean)==null?void 0:e.values)()||[])=>(d(e,((r,s,n,i)=>{t.includes(r)&&(delete n[s],f(n)&&delete e[i])})),e),p=(e,t)=>e&&(d(e,((r,s,n,i)=>{t.includes(`${i.toString()}.${s.toString()}`)&&(delete n[s],f(n)&&delete e[i])})),e),w=e=>(d(e,((e,t,r)=>(typeof e!="function"||(r[t]=e()),!0))),e);const y=(e,t)=>{const r=t.split(".");if(r.length!==2)return;const s=e[r[0]];if(s)return s[r[1]]},v=e=>{if(!e)return[];const t=[];return d(e,((e,r,s,n)=>{t.push(`${n.toString()}.${r.toString()}`)})),t},b=l.logging;var m=(e=>(e[e.error=0]="error",e[e.warn=1]="warn",e[e.log=2]="log",e))(m||{});const E=class e{constructor(e,t){a(this,"prefix");a(this,"settings");this.prefix=e,this.settings={...b,...t}}_getMergedSettings(e){return e?{...this.settings,...e}:this.settings}_isAllowed(t,r){if(!e.isAvailable||!r.enabled)return!1;const s=m[r.level];switch(t){case"error":case"warn":return s>=m[t];case"info":case"log":case"debug":case"dir":return s>=2;default:return!1}}_log(e,t="log",r){const s=this._getMergedSettings(r);if(this._isAllowed(t,s))switch(t){case"dir":console.log(`[${this.prefix}] ${t}:`),console[t](e);break;default:console[t](`[${this.prefix}] ${e}`)}}log(e,t){this._log(e,"log",t)}dir(e,t){this._log(e,"dir",t)}debug(e,t){this._log(e,"debug",t)}error(e,t){this._log(e,"error",t)}info(e,t){this._log(e,"info",t)}warn(e,t){this._log(e,"warn",t)}};a(E,"isAvailable",(()=>typeof console<"u")());let x=E;const $=(...e)=>{const t={};return e.forEach((e=>{if(f(e))return;const r={...t,...e};let s;for(s in r)typeof r[s]=="object"&&!Array.isArray(r[s])?t[s]={...t[s],...e[s]}:t[s]=r[s]})),t};class _{create(e){return g({context:{timestamp:e.timestamp,server:e.hostname},pageExperience:{pageId:e.url},visitor:{deviceBrowserBreakpoint:e.breakpoint,deviceBrowserHeight:e.height,deviceBrowserOrientation:e.orientation,deviceBrowserWidth:e.width,deviceType:e.deviceType,useragent:e.userAgent}},[void 0])}}const P=l.webProperties,R=()=>window.location.href.replace(/[?#].*/,""),O=()=>(new Date).toISOString(),N=()=>window.location.hostname,D=()=>window.innerHeight.toString(),T=()=>window.innerHeight>window.innerWidth?"p":"l",j=()=>window.innerWidth.toString(),A=()=>window.matchMedia("(hover: none), (pointer: coarse)").matches?"mobile":"desktop",S=()=>window.navigator.userAgent,B=e=>{if(!e.breakpoints||e.breakpoints.length<1)return;const{breakpoints:t}=e,r=()=>{const e=window.innerWidth;let r=0,s=0;for(;s<t.length&&e>=t[s];)r=t[s],s++;return r.toString()};return e.reactiveDimensions?r:r()},G=(e,t)=>{const r={...P,...e},s={breakpoint:B(r),timestamp:O(),hostname:N(),url:r.reactiveUrl?R:R(),height:r.reactiveDimensions?D:D(),orientation:r.reactiveDimensions?T:T(),width:r.reactiveDimensions?j:j(),deviceType:A(),userAgent:S()};return t?t.create(s):s},L=(e,t)=>{switch(t){case"string":case"number":case"boolean":return typeof e===t;case"any[]":return Array.isArray(e)&&e.length>0;case"Record<string, any>":return typeof e=="object"&&!Array.isArray(e)&&Object.keys(e).length>0;case"any":return!0;default:if((typeof e=="boolean"||typeof e=="number"||typeof e=="string")&&t.indexOf("|")>0)return t.split("|").map((e=>{const t=e.trim();return/^'.*'$/.test(t)?t.replace(/(^ ?'?|'? ?$)/g,""):/^(true|false)$/.test(t)?t==="true":/^-?(\d*\.)?\d+$/.test(t)?Number.parseFloat(t):t.replace(/(^ ?'?|'? ?$)/g,"")})).includes(e)}return!0},k=(e,t,r)=>{const s={level:null,issues:[]};if(!r.enabled||!r.eventMatrix)return s;const{events:n,...i}=r.eventMatrix,o=n.indexOf(e);if(o===-1)return s.level="error",s.issues.push({level:"error",type:"EVENT_NOT_FOUND",name:e,message:`'${e}': Event does not exist.`}),s;const a=v(t),c=Object.keys(i),l=a.filter((e=>!c.includes(e)));l.length>0&&(r.allowUnknown||p(t,l),l.forEach((e=>{s.level=s.level??"warn",s.issues.push({level:"warn",type:"PROPERTY_DOES_NOT_EXIST",name:e,message:`'${e}': Property does not exist in the given Event Matrix.${r.allowUnknown?"":" It was omitted from the DataLayer payload."}`})})));let u;for(u in i){const e=i[u],n=typeof e.e[o]<"u",a=e.r===1,c=t?y(t,u):void 0,l=typeof c<"u";if(n&&a&&!l&&(s.level="error",s.issues.push({level:"error",type:"REQUIRED_PROPERTY_MISSING",name:u,message:`'${u}': The required property is missing.`}),!r.verbose)||l&&!L(c,e.t)&&(s.level="error",s.issues.push({level:"error",type:"WRONG_PROPERTY_TYPE",name:u,message:`'${u}': Wrong type detected. Expected '${e.t}', got '${typeof c}'.`}),!r.verbose))return s}return s};class I{constructor(e,t,r="GlobalDataLayer"){a(this,"_className");a(this,"_settings");a(this,"_defaultProperties");a(this,"_logger");a(this,"_webPropertiesHandled",!1);a(this,"_dataLayerStore");a(this,"_extensions",new Map);const s=$(l,e||{});this._className=r,this._logger=new x(this._className,s.logging),this._settings=s,t?this._dataLayerStore=t:typeof window<"u"?(this._dataLayerStore=window.pagData=window.pagData||[],this._logger.info("`dataLayerStore` was set to default `window.pagData`")):(this._dataLayerStore=[],this._logger.info("`dataLayerStore` was set to default `[]`")),this._defaultProperties=[]}setup(){this._handleDefaultWebProperties()}get Settings(){return this._settings}get DataLayerStore(){return this._dataLayerStore}getRegisteredExtension(e){const t=new e;return this.getRegisteredExtensionByClassName(t.className)}getRegisteredExtensionByClassName(e){return this._extensions.has(e)?this._extensions.get(e):void 0}getRegisteredExtensions(){const e=[];for(const t of this._extensions.values())e.push(t);return e}registerExtension(e,t=!1){if(!t&&this._extensions.has(e.className)){this._logger.warn(`Tried to register extension class <${e.className}> which already exists.`);return}e.dataLayerInstance=this,this._extensions.set(e.className,e),t?this._logger.info(`Overriden registration for extension class <${e.className}>.`):this._logger.info(`Registered extension class <${e.className}>.`)}removeExtension(e){const t=new e;if(this._extensions.has(t.className)){this._extensions.delete(t.className);return}this._logger.warn(`Tried to remove not existing extension class <${t.className}>.`)}removeExtensionByClassName(e){if(this._extensions.has(e)){this._extensions.delete(e);return}this._logger.warn(`Tried to remove not existing extension class <${e}>.`)}push(e,t=[{}],r){var s,n;if(e.length===0)return!1;const i=r&&!f(r)?$(this._settings,r):this._settings;Array.isArray(t)||(t=[t]),t.forEach(w);const o=this._eventNamePayloadFactory.create({event:e}),a=w(this.getDefaultProperties(e));i.clean.enabled&&i.clean.executionPlace===c.BEFORE_MERGE&&[a||{},...t].forEach((e=>g(e,i.clean.values)));const l=$(o,a||{},...t);if(i.clean.enabled&&i.clean.executionPlace===c.AFTER_MERGE&&g(l,i.clean.values),(s=i==null?void 0:i.validation)!=null&&s.enabled&&((n=i==null?void 0:i.validation)!=null&&n.eventMatrix)){const t=k(e,l,i.validation),r=t.issues.sort(((e,t)=>e.level!==t.level&&t.level==="warn"?-1:0)).map((e=>`- [${e.level}]: ${e.message}`)).join(`\n`);switch(t.level){case"error":return this._logger.error(`Validation failed for event '${e}' with errors/warnings: \n${r}`,i.logging),!1;case"warn":this._logger.warn(`Validation success for event '${e}' with warnings: \n${r}`,i.logging);break;default:this._logger.info(`Validation success for event '${e}'.`,i.logging);break}}return this._dataLayerStore.push(l),!0}getDefaultProperties(e){const t={byName:[],byArray:[],byRegex:[]};this._defaultProperties.forEach((r=>{if(r.identifier===e)return t.byName.push(r.data);if(Array.isArray(r.identifier)&&r.identifier.includes(e))return t.byArray.push(r.data);if(r.identifier instanceof RegExp&&r.identifier.test(e))return t.byRegex.push(r.data)}));const r=[...t.byRegex,...t.byArray,...t.byName];if(r.length)return $(...r)}setDefaultProperties(e,t){const r=this._defaultProperties.find((t=>t.identifier===e));if(r){r.data=$(r.data,t);return}this._defaultProperties.push({identifier:e,data:t})}_handleDefaultWebProperties(){if(this._webPropertiesHandled||!this._settings.webProperties.enabled)return;const e=G(this._settings.webProperties,this._webPayloadFactory);this.setDefaultProperties(this._settings.webProperties.eventNamePattern,e),this._webPropertiesHandled=!0}}class M extends I{constructor(e,t,r="GlobalDataLayer"){super(e,t,r);a(this,"_eventNamePayloadFactory");a(this,"_webPayloadFactory");this._eventNamePayloadFactory=new u,this._webPayloadFactory=new _,this.setup()}setup(){super.setup()}}function F(e){switch(e){case r.PRODUCTION:return"P";case r.PREVIEW:return"PP";default:return"K"}}class U{constructor(){this.homeNavEventId=/^PAGHomeNav_/;this.initialise()}initialise(){this.gdl=new M}pushDataLayerEvent(e,t){if(t){this.gdl.push(e,t)}else{this.gdl.push(e)}}setEnvironment(e){this.gdl.setDefaultProperties(this.homeNavEventId,{context:{environment:F(e)}})}setPageName(e){this.gdl.setDefaultProperties(this.homeNavEventId,{pageExperience:{pageName:e}})}setUser(e,t){this.gdl.setDefaultProperties(this.homeNavEventId,{ids:{userId:e},visitor:{loginStatus:t}})}setLocale(t){try{const{country:r,language:s}=e(t);this.gdl.setDefaultProperties(this.homeNavEventId,{context:{country:r,language:s}})}catch(e){}}setDefaultProperties(r,i){let o={context:{applicationId:s},visitor:{loginStatus:false}};try{const{country:s,language:n}=e(r);o=Object.assign(Object.assign({},o),{context:Object.assign(Object.assign({},o.context),{country:s,language:n,applicationName:t})})}catch(e){}if(n(i)){o=Object.assign(Object.assign({},o),{pageExperience:{pageName:i}})}this.gdl.setDefaultProperties(this.homeNavEventId,o)}}const V=new U;export{V as g};
//# sourceMappingURL=p-dc3f8306.js.map